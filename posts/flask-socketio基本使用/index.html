<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Flask SocketIOåŸºæœ¬ä½¿ç”¨ | Jerry Wang</title>
<meta name=keywords content="Python,Flask,SocketIO"><meta name=description content="Flask-SocketIOæ˜¯ä¸€ä¸ªç”¨äºå»ºç«‹WebSocketå…¨åŒå·¥é€šä¿¡çš„Flaskæ‰©å±•ã€‚å®¢æˆ·ç«¯åº”ç”¨å¯ä»¥ä½¿ç”¨ä»»ä¸€SocketIOå®˜æ–¹å®¢æˆ·ç«¯åº“å®ç°ï¼Œæˆ–å¯ä»¥å»ºç«‹æŒä¹…è¿æ¥çš„å…¼å®¹å®¢æˆ·ç«¯å®ç°ã€‚
1.å®‰è£…

pip install flask-socketio
Flask-SocketIOæä¾›ä¸‰ç§å¼‚æ­¥æœåŠ¡æœºåˆ¶ï¼š

eventletï¼šæ”¯æŒé•¿è½®è¯¢å’Œwebsocket
geventï¼šéœ€ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“
Werkzeugï¼šä»…æ”¯æŒé•¿è½®è¯¢

2.åˆå§‹åŒ–
from flask import Flask, render_template
from flask_socketio import SocketIO

app = Flask(__name__)
app.config['SECRET_KEY'] = 'secret!'
socketio = SocketIO(app)

if __name__ == '__main__':
    socketio.run(app)
åº”ç”¨å¿…é¡»ç»™å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªhtmlé¡µé¢åŠ è½½SocketIOåº“ï¼Œå¹¶ä¸”å»ºç«‹è¿æ¥ï¼š
<script type=&#34;text/javascript&#34; src=&#34;//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js&#34;></script>
<script type=&#34;text/javascript&#34; charset=&#34;utf-8&#34;>
    var socket = io.connect('http://' + document.domain + ':' + location.port);
    socket.on('connect', function() {
        socket.emit('my event', {data: 'I\'m connected!'});
    });
</script>
3.æ¥æ”¶æ¶ˆæ¯
ä½¿ç”¨SocketIOæ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä»¥äº‹ä»¶çš„æ–¹å¼æ¥æ”¶æ¶ˆæ¯-äº‹ä»¶é©±åŠ¨ã€‚åœ¨å®¢æˆ·ç«¯ï¼Œjavascriptä½¿ç”¨å›è°ƒå‡½æ•°ã€‚åœ¨æœåŠ¡ç«¯ï¼ŒFlask-SocketIOéœ€è¦æ³¨å†Œäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç±»ä¼¼äºè·¯ç”±-è§†å›¾å‡½æ•°æœºåˆ¶ã€‚
ä¸‹é¢çš„ä¾‹å­åˆ›å»ºæœåŠ¡ç«¯æ— åäº‹ä»¶å¤„ç†å‡½æ•°ï¼š
@socketio.on('message')
def handle_message(message):
    print('received message: ' + message)
ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨å­—ç¬¦ä¸²æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨jsonæ ¼å¼çš„æ¶ˆæ¯ï¼š
@socketio.on('json')
def handle_json(json):
    print('received json: ' + str(json))
æœ€çµæ´»çš„äº‹ä»¶ç±»å‹æ˜¯ä½¿ç”¨å®šåˆ¶äº‹ä»¶åç§°ã€‚è¿™äº›äº‹ä»¶çš„æ¶ˆæ¯æ•°æ®æ ¼å¼å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€å­—èŠ‚ã€æ•´æ•°æˆ–è€…jsonï¼š
@socketio.on('my event')
def handle_my_custom_event(json):
    print('received json: ' + str(json))
å®šåˆ¶çš„å‘½åäº‹ä»¶æ”¯æŒå¤šå‚æ•°ï¼š
@socketio.on('my event')
def handle_my_custom_event(arg1, arg2, arg3):
    print('received args: ' + arg1 + arg2 + arg3)
å‘½åäº‹ä»¶æ˜¯æœ€çµæ´»çš„ï¼Œå› ä¸ºå‘½åäº‹ä»¶æ¶ˆé™¤äº†åŒ…å«é™„åŠ å…ƒæ•°æ®ï¼ˆæè¿°æ¶ˆæ¯ç±»å‹ï¼‰çš„éœ€è¦ã€‚Flask-socketIOä¹Ÿæ”¯æŒSocketIOå‘½ååŸŸï¼ŒSocketIOå‘½ååŸŸå…è®¸å®¢æˆ·ç«¯å¤ç”¨socketï¼ˆå¤šä¸ªè¿æ¥å»ºç«‹åœ¨åŒä¸€ç‰©ç†socketï¼‰ã€‚
@socketio.on('my event', namespace='/test')
def handle_my_custom_namespace_event(json):
    print('received json: ' + str(json))
å½“SocketIOæ²¡æœ‰æ˜¾å¼æŒ‡å®šå‘½ååŸŸï¼Œå…¨å±€å‘½ååŸŸâ€˜ï¼â€™å°†ä¼šè¢«ä½¿ç”¨ã€‚
å½“è£…é¥°å™¨è¯­æ³•ä¸å¤ªåˆé€‚æ—¶ï¼Œon_eventæ–¹æ³•å¯è¢«ä½¿ç”¨ï¼š
def my_function_handler(data):
    pass

socketio.on_event('my event', my_function_handler, namespace='/test')
å®¢æˆ·ç«¯å¯èƒ½è¯·æ±‚ä¸€ä¸ªæ‰¿è®¤çš„å›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°ç¡®è®¤æ¥æ”¶å‘é€çš„æ¶ˆæ¯ã€‚å¤„ç†å‡½æ•°çš„ä»»ä½•è¿”å›å€¼å°†ä¼šä½œä¸ºå‚æ•°é€’é€ç»™å®¢æˆ·ç«¯çš„å›è°ƒå‡½æ•°ï¼š"><meta name=author content="Jerry Wang"><link rel=canonical href=https://solaim.github.io/posts/flask-socketio%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://solaim.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://solaim.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://solaim.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://solaim.github.io/apple-touch-icon.png><link rel=mask-icon href=https://solaim.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://solaim.github.io/posts/flask-socketio%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://solaim.github.io/posts/flask-socketio%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"><meta property="og:site_name" content="Jerry Wang"><meta property="og:title" content="Flask SocketIOåŸºæœ¬ä½¿ç”¨"><meta property="og:description" content="Flask-SocketIOæ˜¯ä¸€ä¸ªç”¨äºå»ºç«‹WebSocketå…¨åŒå·¥é€šä¿¡çš„Flaskæ‰©å±•ã€‚å®¢æˆ·ç«¯åº”ç”¨å¯ä»¥ä½¿ç”¨ä»»ä¸€SocketIOå®˜æ–¹å®¢æˆ·ç«¯åº“å®ç°ï¼Œæˆ–å¯ä»¥å»ºç«‹æŒä¹…è¿æ¥çš„å…¼å®¹å®¢æˆ·ç«¯å®ç°ã€‚
1.å®‰è£… pip install flask-socketio
Flask-SocketIOæä¾›ä¸‰ç§å¼‚æ­¥æœåŠ¡æœºåˆ¶ï¼š
eventletï¼šæ”¯æŒé•¿è½®è¯¢å’Œwebsocket geventï¼šéœ€ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ Werkzeugï¼šä»…æ”¯æŒé•¿è½®è¯¢ 2.åˆå§‹åŒ– from flask import Flask, render_template from flask_socketio import SocketIO app = Flask(__name__) app.config['SECRET_KEY'] = 'secret!' socketio = SocketIO(app) if __name__ == '__main__': socketio.run(app) åº”ç”¨å¿…é¡»ç»™å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªhtmlé¡µé¢åŠ è½½SocketIOåº“ï¼Œå¹¶ä¸”å»ºç«‹è¿æ¥ï¼š
<script type=&#34;text/javascript&#34; src=&#34;//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js&#34;></script> <script type=&#34;text/javascript&#34; charset=&#34;utf-8&#34;> var socket = io.connect('http://' + document.domain + ':' + location.port); socket.on('connect', function() { socket.emit('my event', {data: 'I\'m connected!'}); }); </script> 3.æ¥æ”¶æ¶ˆæ¯ ä½¿ç”¨SocketIOæ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä»¥äº‹ä»¶çš„æ–¹å¼æ¥æ”¶æ¶ˆæ¯-äº‹ä»¶é©±åŠ¨ã€‚åœ¨å®¢æˆ·ç«¯ï¼Œjavascriptä½¿ç”¨å›è°ƒå‡½æ•°ã€‚åœ¨æœåŠ¡ç«¯ï¼ŒFlask-SocketIOéœ€è¦æ³¨å†Œäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç±»ä¼¼äºè·¯ç”±-è§†å›¾å‡½æ•°æœºåˆ¶ã€‚
ä¸‹é¢çš„ä¾‹å­åˆ›å»ºæœåŠ¡ç«¯æ— åäº‹ä»¶å¤„ç†å‡½æ•°ï¼š
@socketio.on('message') def handle_message(message): print('received message: ' + message) ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨å­—ç¬¦ä¸²æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨jsonæ ¼å¼çš„æ¶ˆæ¯ï¼š
@socketio.on('json') def handle_json(json): print('received json: ' + str(json)) æœ€çµæ´»çš„äº‹ä»¶ç±»å‹æ˜¯ä½¿ç”¨å®šåˆ¶äº‹ä»¶åç§°ã€‚è¿™äº›äº‹ä»¶çš„æ¶ˆæ¯æ•°æ®æ ¼å¼å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€å­—èŠ‚ã€æ•´æ•°æˆ–è€…jsonï¼š
@socketio.on('my event') def handle_my_custom_event(json): print('received json: ' + str(json)) å®šåˆ¶çš„å‘½åäº‹ä»¶æ”¯æŒå¤šå‚æ•°ï¼š
@socketio.on('my event') def handle_my_custom_event(arg1, arg2, arg3): print('received args: ' + arg1 + arg2 + arg3) å‘½åäº‹ä»¶æ˜¯æœ€çµæ´»çš„ï¼Œå› ä¸ºå‘½åäº‹ä»¶æ¶ˆé™¤äº†åŒ…å«é™„åŠ å…ƒæ•°æ®ï¼ˆæè¿°æ¶ˆæ¯ç±»å‹ï¼‰çš„éœ€è¦ã€‚Flask-socketIOä¹Ÿæ”¯æŒSocketIOå‘½ååŸŸï¼ŒSocketIOå‘½ååŸŸå…è®¸å®¢æˆ·ç«¯å¤ç”¨socketï¼ˆå¤šä¸ªè¿æ¥å»ºç«‹åœ¨åŒä¸€ç‰©ç†socketï¼‰ã€‚
@socketio.on('my event', namespace='/test') def handle_my_custom_namespace_event(json): print('received json: ' + str(json)) å½“SocketIOæ²¡æœ‰æ˜¾å¼æŒ‡å®šå‘½ååŸŸï¼Œå…¨å±€å‘½ååŸŸâ€˜ï¼â€™å°†ä¼šè¢«ä½¿ç”¨ã€‚
å½“è£…é¥°å™¨è¯­æ³•ä¸å¤ªåˆé€‚æ—¶ï¼Œon_eventæ–¹æ³•å¯è¢«ä½¿ç”¨ï¼š
def my_function_handler(data): pass socketio.on_event('my event', my_function_handler, namespace='/test') å®¢æˆ·ç«¯å¯èƒ½è¯·æ±‚ä¸€ä¸ªæ‰¿è®¤çš„å›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°ç¡®è®¤æ¥æ”¶å‘é€çš„æ¶ˆæ¯ã€‚å¤„ç†å‡½æ•°çš„ä»»ä½•è¿”å›å€¼å°†ä¼šä½œä¸ºå‚æ•°é€’é€ç»™å®¢æˆ·ç«¯çš„å›è°ƒå‡½æ•°ï¼š"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-04-11T21:22:26+08:00"><meta property="article:modified_time" content="2019-04-11T21:22:26+08:00"><meta property="article:tag" content="Python"><meta property="article:tag" content="Flask"><meta property="article:tag" content="SocketIO"><meta property="og:image" content="https://solaim.github.io/img/favicon.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://solaim.github.io/img/favicon.webp"><meta name=twitter:title content="Flask SocketIOåŸºæœ¬ä½¿ç”¨"><meta name=twitter:description content="Flask-SocketIOæ˜¯ä¸€ä¸ªç”¨äºå»ºç«‹WebSocketå…¨åŒå·¥é€šä¿¡çš„Flaskæ‰©å±•ã€‚å®¢æˆ·ç«¯åº”ç”¨å¯ä»¥ä½¿ç”¨ä»»ä¸€SocketIOå®˜æ–¹å®¢æˆ·ç«¯åº“å®ç°ï¼Œæˆ–å¯ä»¥å»ºç«‹æŒä¹…è¿æ¥çš„å…¼å®¹å®¢æˆ·ç«¯å®ç°ã€‚
1.å®‰è£…

pip install flask-socketio
Flask-SocketIOæä¾›ä¸‰ç§å¼‚æ­¥æœåŠ¡æœºåˆ¶ï¼š

eventletï¼šæ”¯æŒé•¿è½®è¯¢å’Œwebsocket
geventï¼šéœ€ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“
Werkzeugï¼šä»…æ”¯æŒé•¿è½®è¯¢

2.åˆå§‹åŒ–
from flask import Flask, render_template
from flask_socketio import SocketIO

app = Flask(__name__)
app.config['SECRET_KEY'] = 'secret!'
socketio = SocketIO(app)

if __name__ == '__main__':
    socketio.run(app)
åº”ç”¨å¿…é¡»ç»™å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªhtmlé¡µé¢åŠ è½½SocketIOåº“ï¼Œå¹¶ä¸”å»ºç«‹è¿æ¥ï¼š
<script type=&#34;text/javascript&#34; src=&#34;//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js&#34;></script>
<script type=&#34;text/javascript&#34; charset=&#34;utf-8&#34;>
    var socket = io.connect('http://' + document.domain + ':' + location.port);
    socket.on('connect', function() {
        socket.emit('my event', {data: 'I\'m connected!'});
    });
</script>
3.æ¥æ”¶æ¶ˆæ¯
ä½¿ç”¨SocketIOæ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä»¥äº‹ä»¶çš„æ–¹å¼æ¥æ”¶æ¶ˆæ¯-äº‹ä»¶é©±åŠ¨ã€‚åœ¨å®¢æˆ·ç«¯ï¼Œjavascriptä½¿ç”¨å›è°ƒå‡½æ•°ã€‚åœ¨æœåŠ¡ç«¯ï¼ŒFlask-SocketIOéœ€è¦æ³¨å†Œäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç±»ä¼¼äºè·¯ç”±-è§†å›¾å‡½æ•°æœºåˆ¶ã€‚
ä¸‹é¢çš„ä¾‹å­åˆ›å»ºæœåŠ¡ç«¯æ— åäº‹ä»¶å¤„ç†å‡½æ•°ï¼š
@socketio.on('message')
def handle_message(message):
    print('received message: ' + message)
ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨å­—ç¬¦ä¸²æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨jsonæ ¼å¼çš„æ¶ˆæ¯ï¼š
@socketio.on('json')
def handle_json(json):
    print('received json: ' + str(json))
æœ€çµæ´»çš„äº‹ä»¶ç±»å‹æ˜¯ä½¿ç”¨å®šåˆ¶äº‹ä»¶åç§°ã€‚è¿™äº›äº‹ä»¶çš„æ¶ˆæ¯æ•°æ®æ ¼å¼å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€å­—èŠ‚ã€æ•´æ•°æˆ–è€…jsonï¼š
@socketio.on('my event')
def handle_my_custom_event(json):
    print('received json: ' + str(json))
å®šåˆ¶çš„å‘½åäº‹ä»¶æ”¯æŒå¤šå‚æ•°ï¼š
@socketio.on('my event')
def handle_my_custom_event(arg1, arg2, arg3):
    print('received args: ' + arg1 + arg2 + arg3)
å‘½åäº‹ä»¶æ˜¯æœ€çµæ´»çš„ï¼Œå› ä¸ºå‘½åäº‹ä»¶æ¶ˆé™¤äº†åŒ…å«é™„åŠ å…ƒæ•°æ®ï¼ˆæè¿°æ¶ˆæ¯ç±»å‹ï¼‰çš„éœ€è¦ã€‚Flask-socketIOä¹Ÿæ”¯æŒSocketIOå‘½ååŸŸï¼ŒSocketIOå‘½ååŸŸå…è®¸å®¢æˆ·ç«¯å¤ç”¨socketï¼ˆå¤šä¸ªè¿æ¥å»ºç«‹åœ¨åŒä¸€ç‰©ç†socketï¼‰ã€‚
@socketio.on('my event', namespace='/test')
def handle_my_custom_namespace_event(json):
    print('received json: ' + str(json))
å½“SocketIOæ²¡æœ‰æ˜¾å¼æŒ‡å®šå‘½ååŸŸï¼Œå…¨å±€å‘½ååŸŸâ€˜ï¼â€™å°†ä¼šè¢«ä½¿ç”¨ã€‚
å½“è£…é¥°å™¨è¯­æ³•ä¸å¤ªåˆé€‚æ—¶ï¼Œon_eventæ–¹æ³•å¯è¢«ä½¿ç”¨ï¼š
def my_function_handler(data):
    pass

socketio.on_event('my event', my_function_handler, namespace='/test')
å®¢æˆ·ç«¯å¯èƒ½è¯·æ±‚ä¸€ä¸ªæ‰¿è®¤çš„å›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°ç¡®è®¤æ¥æ”¶å‘é€çš„æ¶ˆæ¯ã€‚å¤„ç†å‡½æ•°çš„ä»»ä½•è¿”å›å€¼å°†ä¼šä½œä¸ºå‚æ•°é€’é€ç»™å®¢æˆ·ç«¯çš„å›è°ƒå‡½æ•°ï¼š"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://solaim.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Flask SocketIOåŸºæœ¬ä½¿ç”¨","item":"https://solaim.github.io/posts/flask-socketio%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Flask SocketIOåŸºæœ¬ä½¿ç”¨","name":"Flask SocketIOåŸºæœ¬ä½¿ç”¨","description":"Flask-SocketIOæ˜¯ä¸€ä¸ªç”¨äºå»ºç«‹WebSocketå…¨åŒå·¥é€šä¿¡çš„Flaskæ‰©å±•ã€‚å®¢æˆ·ç«¯åº”ç”¨å¯ä»¥ä½¿ç”¨ä»»ä¸€SocketIOå®˜æ–¹å®¢æˆ·ç«¯åº“å®ç°ï¼Œæˆ–å¯ä»¥å»ºç«‹æŒä¹…è¿æ¥çš„å…¼å®¹å®¢æˆ·ç«¯å®ç°ã€‚\n1.å®‰è£… pip install flask-socketio\nFlask-SocketIOæä¾›ä¸‰ç§å¼‚æ­¥æœåŠ¡æœºåˆ¶ï¼š\neventletï¼šæ”¯æŒé•¿è½®è¯¢å’Œwebsocket geventï¼šéœ€ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ Werkzeugï¼šä»…æ”¯æŒé•¿è½®è¯¢ 2.åˆå§‹åŒ– from flask import Flask, render_template from flask_socketio import SocketIO app = Flask(__name__) app.config[\u0026#39;SECRET_KEY\u0026#39;] = \u0026#39;secret!\u0026#39; socketio = SocketIO(app) if __name__ == \u0026#39;__main__\u0026#39;: socketio.run(app) åº”ç”¨å¿…é¡»ç»™å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªhtmlé¡µé¢åŠ è½½SocketIOåº“ï¼Œå¹¶ä¸”å»ºç«‹è¿æ¥ï¼š\n\u0026lt;script type=\u0026#34;text/javascript\u0026#34; src=\u0026#34;//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34; charset=\u0026#34;utf-8\u0026#34;\u0026gt; var socket = io.connect(\u0026#39;http://\u0026#39; + document.domain + \u0026#39;:\u0026#39; + location.port); socket.on(\u0026#39;connect\u0026#39;, function() { socket.emit(\u0026#39;my event\u0026#39;, {data: \u0026#39;I\\\u0026#39;m connected!\u0026#39;}); }); \u0026lt;/script\u0026gt; 3.æ¥æ”¶æ¶ˆæ¯ ä½¿ç”¨SocketIOæ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä»¥äº‹ä»¶çš„æ–¹å¼æ¥æ”¶æ¶ˆæ¯-äº‹ä»¶é©±åŠ¨ã€‚åœ¨å®¢æˆ·ç«¯ï¼Œjavascriptä½¿ç”¨å›è°ƒå‡½æ•°ã€‚åœ¨æœåŠ¡ç«¯ï¼ŒFlask-SocketIOéœ€è¦æ³¨å†Œäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç±»ä¼¼äºè·¯ç”±-è§†å›¾å‡½æ•°æœºåˆ¶ã€‚\nä¸‹é¢çš„ä¾‹å­åˆ›å»ºæœåŠ¡ç«¯æ— åäº‹ä»¶å¤„ç†å‡½æ•°ï¼š\n@socketio.on(\u0026#39;message\u0026#39;) def handle_message(message): print(\u0026#39;received message: \u0026#39; + message) ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨å­—ç¬¦ä¸²æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨jsonæ ¼å¼çš„æ¶ˆæ¯ï¼š\n@socketio.on(\u0026#39;json\u0026#39;) def handle_json(json): print(\u0026#39;received json: \u0026#39; + str(json)) æœ€çµæ´»çš„äº‹ä»¶ç±»å‹æ˜¯ä½¿ç”¨å®šåˆ¶äº‹ä»¶åç§°ã€‚è¿™äº›äº‹ä»¶çš„æ¶ˆæ¯æ•°æ®æ ¼å¼å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€å­—èŠ‚ã€æ•´æ•°æˆ–è€…jsonï¼š\n@socketio.on(\u0026#39;my event\u0026#39;) def handle_my_custom_event(json): print(\u0026#39;received json: \u0026#39; + str(json)) å®šåˆ¶çš„å‘½åäº‹ä»¶æ”¯æŒå¤šå‚æ•°ï¼š\n@socketio.on(\u0026#39;my event\u0026#39;) def handle_my_custom_event(arg1, arg2, arg3): print(\u0026#39;received args: \u0026#39; + arg1 + arg2 + arg3) å‘½åäº‹ä»¶æ˜¯æœ€çµæ´»çš„ï¼Œå› ä¸ºå‘½åäº‹ä»¶æ¶ˆé™¤äº†åŒ…å«é™„åŠ å…ƒæ•°æ®ï¼ˆæè¿°æ¶ˆæ¯ç±»å‹ï¼‰çš„éœ€è¦ã€‚Flask-socketIOä¹Ÿæ”¯æŒSocketIOå‘½ååŸŸï¼ŒSocketIOå‘½ååŸŸå…è®¸å®¢æˆ·ç«¯å¤ç”¨socketï¼ˆå¤šä¸ªè¿æ¥å»ºç«‹åœ¨åŒä¸€ç‰©ç†socketï¼‰ã€‚\n@socketio.on(\u0026#39;my event\u0026#39;, namespace=\u0026#39;/test\u0026#39;) def handle_my_custom_namespace_event(json): print(\u0026#39;received json: \u0026#39; + str(json)) å½“SocketIOæ²¡æœ‰æ˜¾å¼æŒ‡å®šå‘½ååŸŸï¼Œå…¨å±€å‘½ååŸŸâ€˜ï¼â€™å°†ä¼šè¢«ä½¿ç”¨ã€‚\nå½“è£…é¥°å™¨è¯­æ³•ä¸å¤ªåˆé€‚æ—¶ï¼Œon_eventæ–¹æ³•å¯è¢«ä½¿ç”¨ï¼š\ndef my_function_handler(data): pass socketio.on_event(\u0026#39;my event\u0026#39;, my_function_handler, namespace=\u0026#39;/test\u0026#39;) å®¢æˆ·ç«¯å¯èƒ½è¯·æ±‚ä¸€ä¸ªæ‰¿è®¤çš„å›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°ç¡®è®¤æ¥æ”¶å‘é€çš„æ¶ˆæ¯ã€‚å¤„ç†å‡½æ•°çš„ä»»ä½•è¿”å›å€¼å°†ä¼šä½œä¸ºå‚æ•°é€’é€ç»™å®¢æˆ·ç«¯çš„å›è°ƒå‡½æ•°ï¼š\n","keywords":["Python","Flask","SocketIO"],"articleBody":"Flask-SocketIOæ˜¯ä¸€ä¸ªç”¨äºå»ºç«‹WebSocketå…¨åŒå·¥é€šä¿¡çš„Flaskæ‰©å±•ã€‚å®¢æˆ·ç«¯åº”ç”¨å¯ä»¥ä½¿ç”¨ä»»ä¸€SocketIOå®˜æ–¹å®¢æˆ·ç«¯åº“å®ç°ï¼Œæˆ–å¯ä»¥å»ºç«‹æŒä¹…è¿æ¥çš„å…¼å®¹å®¢æˆ·ç«¯å®ç°ã€‚\n1.å®‰è£… pip install flask-socketio\nFlask-SocketIOæä¾›ä¸‰ç§å¼‚æ­¥æœåŠ¡æœºåˆ¶ï¼š\neventletï¼šæ”¯æŒé•¿è½®è¯¢å’Œwebsocket geventï¼šéœ€ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ Werkzeugï¼šä»…æ”¯æŒé•¿è½®è¯¢ 2.åˆå§‹åŒ– from flask import Flask, render_template from flask_socketio import SocketIO app = Flask(__name__) app.config['SECRET_KEY'] = 'secret!' socketio = SocketIO(app) if __name__ == '__main__': socketio.run(app) åº”ç”¨å¿…é¡»ç»™å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªhtmlé¡µé¢åŠ è½½SocketIOåº“ï¼Œå¹¶ä¸”å»ºç«‹è¿æ¥ï¼š\n\u003cscript type=\"text/javascript\" src=\"//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js\"\u003e\u003c/script\u003e \u003cscript type=\"text/javascript\" charset=\"utf-8\"\u003e var socket = io.connect('http://' + document.domain + ':' + location.port); socket.on('connect', function() { socket.emit('my event', {data: 'I\\'m connected!'}); }); \u003c/script\u003e 3.æ¥æ”¶æ¶ˆæ¯ ä½¿ç”¨SocketIOæ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä»¥äº‹ä»¶çš„æ–¹å¼æ¥æ”¶æ¶ˆæ¯-äº‹ä»¶é©±åŠ¨ã€‚åœ¨å®¢æˆ·ç«¯ï¼Œjavascriptä½¿ç”¨å›è°ƒå‡½æ•°ã€‚åœ¨æœåŠ¡ç«¯ï¼ŒFlask-SocketIOéœ€è¦æ³¨å†Œäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç±»ä¼¼äºè·¯ç”±-è§†å›¾å‡½æ•°æœºåˆ¶ã€‚\nä¸‹é¢çš„ä¾‹å­åˆ›å»ºæœåŠ¡ç«¯æ— åäº‹ä»¶å¤„ç†å‡½æ•°ï¼š\n@socketio.on('message') def handle_message(message): print('received message: ' + message) ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨å­—ç¬¦ä¸²æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨jsonæ ¼å¼çš„æ¶ˆæ¯ï¼š\n@socketio.on('json') def handle_json(json): print('received json: ' + str(json)) æœ€çµæ´»çš„äº‹ä»¶ç±»å‹æ˜¯ä½¿ç”¨å®šåˆ¶äº‹ä»¶åç§°ã€‚è¿™äº›äº‹ä»¶çš„æ¶ˆæ¯æ•°æ®æ ¼å¼å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€å­—èŠ‚ã€æ•´æ•°æˆ–è€…jsonï¼š\n@socketio.on('my event') def handle_my_custom_event(json): print('received json: ' + str(json)) å®šåˆ¶çš„å‘½åäº‹ä»¶æ”¯æŒå¤šå‚æ•°ï¼š\n@socketio.on('my event') def handle_my_custom_event(arg1, arg2, arg3): print('received args: ' + arg1 + arg2 + arg3) å‘½åäº‹ä»¶æ˜¯æœ€çµæ´»çš„ï¼Œå› ä¸ºå‘½åäº‹ä»¶æ¶ˆé™¤äº†åŒ…å«é™„åŠ å…ƒæ•°æ®ï¼ˆæè¿°æ¶ˆæ¯ç±»å‹ï¼‰çš„éœ€è¦ã€‚Flask-socketIOä¹Ÿæ”¯æŒSocketIOå‘½ååŸŸï¼ŒSocketIOå‘½ååŸŸå…è®¸å®¢æˆ·ç«¯å¤ç”¨socketï¼ˆå¤šä¸ªè¿æ¥å»ºç«‹åœ¨åŒä¸€ç‰©ç†socketï¼‰ã€‚\n@socketio.on('my event', namespace='/test') def handle_my_custom_namespace_event(json): print('received json: ' + str(json)) å½“SocketIOæ²¡æœ‰æ˜¾å¼æŒ‡å®šå‘½ååŸŸï¼Œå…¨å±€å‘½ååŸŸâ€˜ï¼â€™å°†ä¼šè¢«ä½¿ç”¨ã€‚\nå½“è£…é¥°å™¨è¯­æ³•ä¸å¤ªåˆé€‚æ—¶ï¼Œon_eventæ–¹æ³•å¯è¢«ä½¿ç”¨ï¼š\ndef my_function_handler(data): pass socketio.on_event('my event', my_function_handler, namespace='/test') å®¢æˆ·ç«¯å¯èƒ½è¯·æ±‚ä¸€ä¸ªæ‰¿è®¤çš„å›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°ç¡®è®¤æ¥æ”¶å‘é€çš„æ¶ˆæ¯ã€‚å¤„ç†å‡½æ•°çš„ä»»ä½•è¿”å›å€¼å°†ä¼šä½œä¸ºå‚æ•°é€’é€ç»™å®¢æˆ·ç«¯çš„å›è°ƒå‡½æ•°ï¼š\n@socketio.on('my event') def handle_my_custom_event(json): print('received json: ' + str(json)) return 'one', 2 ä¸Šä¾‹ä¸­ï¼Œå®¢æˆ·ç«¯å›è°ƒå‡½æ•°å°†ä¼šè¢«ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼šâ€˜oneâ€™å’Œ2ã€‚\n4ã€å‘é€æ¶ˆæ¯ Socket IOäº‹ä»¶å¤„ç†å‡½æ•°å¯ä»¥å‘é€å›å¤æ¶ˆæ¯è‡³è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæ–¹æ³•åŒ…æ‹¬send()å’Œemit()ã€‚\nfrom flask_socketio import send, emit @socketio.on('message') def handle_message(message): send(message) @socketio.on('json') def handle_json(json): send(json, json=True) @socketio.on('my event') def handle_my_custom_event(json): emit('my response', json) å½“ä½¿ç”¨å‘½ååŸŸæ—¶ï¼Œsendå’Œemité»˜è®¤ä½¿ç”¨æ¥æ”¶æ¶ˆæ¯çš„å‘½ååŸŸã€‚ä¸åŒçš„å‘½ååŸŸå¯ä»¥é€šè¿‡namespaceå‚æ•°æŒ‡å®šã€‚\n@socketio.on('message') def handle_message(message): send(message, namespace='/chat') @socketio.on('my event') def handle_my_custom_event(json): emit('my response', json, namespace='/chat') å½“ä½¿ç”¨å¤šä¸ªå‚æ•°å›å¤ä¸€ä¸ªäº‹ä»¶æ—¶ï¼Œå‘é€ä¸€ä¸ªtupleï¼š\n@socketio.on('my event') def handle_my_custom_event(json): emit('my response', ('foo', 'bar', json), namespace='/chat') SocketIOæ”¯æŒå›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°ç”¨äºè¯å®å®¢æˆ·ç«¯æˆåŠŸæ¥æ”¶äº†æ¶ˆæ¯ï¼š\ndef ack(): print 'message was received!' @socketio.on('my event') def handle_my_custom_event(json): emit('my response', json, callback=ack) å½“ä½¿ç”¨å›è°ƒå‡½æ•°æ—¶ï¼Œjså®¢æˆ·ç«¯ä»æ¥æ”¶çš„æ¶ˆæ¯ä¸­è·å–å›è°ƒå‡½æ•°ï¼Œå®¢æˆ·ç«¯å›è°ƒå‡½æ•°å”¤èµ·ä¹‹åæœåŠ¡ç«¯çš„å›è°ƒå‡½æ•°ç›¸åº”åœ°è¢«å”¤èµ·ã€‚å¦‚æ­Œå®¢æˆ·ç«¯å›è°ƒå‡½æ•°å…·æœ‰å‚æ•°ï¼ŒæœåŠ¡ç«¯çš„å›è°ƒå‡½æ•°å…·æœ‰ç›¸åŒçš„å‚æ•°ã€‚\n5ã€å¹¿æ’­ Flask-SocketIOæ”¯æŒå¹¿æ’­ï¼Œåªéœ€åœ¨sendå’Œemitå‡½æ•°ä¸­æ·»åŠ å…³é”®å­—å‚æ•°broadcast=Trueï¼š\n@socketio.on('my event') def handle_my_custom_event(data): emit('my response', data, broadcast=True) å¯¹äºæœåŠ¡ç«¯ä¸»åŠ¨å‘èµ·çš„å¹¿æ’­ï¼Œsocketio.send()å’Œsocketio.emit()æ–¹æ³•å¯ä»¥ç”¨æ¥å¹¿æ’­æ¶ˆæ¯è‡³æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯ã€‚\ndef some_function(): socketio.emit('some event', {'data': 42}) 6ã€Rooms Flask-SocketIOé€šè¿‡join_roomå’Œleave_roomå‡½æ•°æ”¯æŒroomæ¦‚å¿µã€‚\nfrom flask_socketio import join_room, leave_room @socketio.on('join') def on_join(data): username = data['username'] room = data['room'] join_room(room) send(username + ' has entered the room.', room=room) @socketio.on('leave') def on_leave(data): username = data['username'] room = data['room'] leave_room(room) send(username + ' has left the room.', room=room) sendå’Œemitå‡½æ•°æ¥æ”¶å…³é”®å­—å‚æ•°roomï¼Œå°†æ¶ˆæ¯å‘é€è‡³è¿æ¥å¯¹åº”roomçš„å®¢æˆ·ç«¯ã€‚\næ‰€æœ‰çš„å®¢æˆ·ç«¯è¿æ¥roomæ—¶ç”¨session IDå‘½åï¼Œå¯ä»¥ä½¿ç”¨request.sidè·å–ã€‚\n7ã€è¿æ¥äº‹ä»¶ Flask-SocketIOä¹Ÿæ”¯æŒè¿æ¥å’Œè¿æ¥æ–­å¼€äº‹ä»¶ã€‚\n@socketio.on('connect', namespace='/chat') def test_connect(): emit('my response', {'data': 'Connected'}) @socketio.on('disconnect', namespace='/chat') def test_disconnect(): print('Client disconnected') 8ã€åŸºäºç±»çš„å‘½ååŸŸ ä¸Šé¢æè¿°çš„æ˜¯åŸºäºè£…é¥°å™¨çš„å¤„ç†å‡½æ•°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŸºäºç±»çš„å‘½ååŸŸå¤„ç†å‡½æ•°ã€‚\nfrom flask_socketio import Namespace, emit class MyCustomNamespace(Namespace): def on_connect(self): pass def on_disconnect(self): pass def on_my_event(self, data): emit('my_response', data) socketio.on_namespace(MyCustomNamespace('/test')) 9ã€é”™è¯¯å¤„ç† @socketio.on_error() # Handles the default namespace def error_handler(e): pass @socketio.on_error('/chat') # handles the '/chat' namespace def error_handler_chat(e): pass @socketio.on_error_default # handles all namespaces without an explicit error handler def default_error_handler(e): pass ","wordCount":"337","inLanguage":"en","image":"https://solaim.github.io/img/favicon.webp","datePublished":"2019-04-11T21:22:26+08:00","dateModified":"2019-04-11T21:22:26+08:00","author":{"@type":"Person","name":"Jerry Wang"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://solaim.github.io/posts/flask-socketio%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"},"publisher":{"@type":"Organization","name":"Jerry Wang","logo":{"@type":"ImageObject","url":"https://solaim.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://solaim.github.io/ accesskey=h title="é¦–é¡µ (Alt + H)"><img src=https://solaim.github.io/apple-touch-icon.png alt aria-label=logo height=35>é¦–é¡µ</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://solaim.github.io/categories/ title=ğŸ•¸åˆ†ç±»><span>ğŸ•¸åˆ†ç±»</span></a></li><li><a href=https://solaim.github.io/tags/ title=ğŸšæ ‡ç­¾><span>ğŸšæ ‡ç­¾</span></a></li><li><a href=https://solaim.github.io/about/ title=ğŸŒå…³äº><span>ğŸŒå…³äº</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://solaim.github.io/>Home</a>&nbsp;Â»&nbsp;<a href=https://solaim.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Flask SocketIOåŸºæœ¬ä½¿ç”¨</h1><div class=post-meta><span title='2019-04-11 21:22:26 +0800 +0800'>2019-04-11</span>&nbsp;Â·&nbsp;Jerry Wang</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#1å®‰è£…>1.å®‰è£…</a></li><li><a href=#2åˆå§‹åŒ–>2.åˆå§‹åŒ–</a></li><li><a href=#3æ¥æ”¶æ¶ˆæ¯>3.æ¥æ”¶æ¶ˆæ¯</a></li><li><a href=#4å‘é€æ¶ˆæ¯>4ã€å‘é€æ¶ˆæ¯</a></li><li><a href=#5å¹¿æ’­>5ã€å¹¿æ’­</a></li><li><a href=#6rooms>6ã€Rooms</a></li><li><a href=#7è¿æ¥äº‹ä»¶>7ã€è¿æ¥äº‹ä»¶</a></li><li><a href=#8åŸºäºç±»çš„å‘½ååŸŸ>8ã€åŸºäºç±»çš„å‘½ååŸŸ</a></li><li><a href=#9é”™è¯¯å¤„ç†>9ã€é”™è¯¯å¤„ç†</a></li></ul></nav></div></details></div><div class=post-content><p>Flask-SocketIOæ˜¯ä¸€ä¸ªç”¨äºå»ºç«‹WebSocketå…¨åŒå·¥é€šä¿¡çš„Flaskæ‰©å±•ã€‚å®¢æˆ·ç«¯åº”ç”¨å¯ä»¥ä½¿ç”¨ä»»ä¸€SocketIOå®˜æ–¹å®¢æˆ·ç«¯åº“å®ç°ï¼Œæˆ–å¯ä»¥å»ºç«‹æŒä¹…è¿æ¥çš„å…¼å®¹å®¢æˆ·ç«¯å®ç°ã€‚</p><h2 id=1å®‰è£…>1.å®‰è£…<a hidden class=anchor aria-hidden=true href=#1å®‰è£…>#</a></h2><blockquote><p>pip install flask-socketio</p></blockquote><p>Flask-SocketIOæä¾›ä¸‰ç§å¼‚æ­¥æœåŠ¡æœºåˆ¶ï¼š</p><ul><li>eventletï¼šæ”¯æŒé•¿è½®è¯¢å’Œwebsocket</li><li>geventï¼šéœ€ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“</li><li>Werkzeugï¼šä»…æ”¯æŒé•¿è½®è¯¢</li></ul><h2 id=2åˆå§‹åŒ–>2.åˆå§‹åŒ–<a hidden class=anchor aria-hidden=true href=#2åˆå§‹åŒ–>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>render_template</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask_socketio</span> <span class=kn>import</span> <span class=n>SocketIO</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>config</span><span class=p>[</span><span class=s1>&#39;SECRET_KEY&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;secret!&#39;</span>
</span></span><span class=line><span class=cl><span class=n>socketio</span> <span class=o>=</span> <span class=n>SocketIO</span><span class=p>(</span><span class=n>app</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>socketio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>app</span><span class=p>)</span>
</span></span></code></pre></div><p>åº”ç”¨å¿…é¡»ç»™å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªhtmlé¡µé¢åŠ è½½SocketIOåº“ï¼Œå¹¶ä¸”å»ºç«‹è¿æ¥ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=o>&lt;</span><span class=nx>script</span> <span class=nx>type</span><span class=o>=</span><span class=s2>&#34;text/javascript&#34;</span> <span class=nx>src</span><span class=o>=</span><span class=s2>&#34;//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js&#34;</span><span class=o>&gt;&lt;</span><span class=err>/script&gt;</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=nx>script</span> <span class=nx>type</span><span class=o>=</span><span class=s2>&#34;text/javascript&#34;</span> <span class=nx>charset</span><span class=o>=</span><span class=s2>&#34;utf-8&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>socket</span> <span class=o>=</span> <span class=nx>io</span><span class=p>.</span><span class=nx>connect</span><span class=p>(</span><span class=s1>&#39;http://&#39;</span> <span class=o>+</span> <span class=nb>document</span><span class=p>.</span><span class=nx>domain</span> <span class=o>+</span> <span class=s1>&#39;:&#39;</span> <span class=o>+</span> <span class=nx>location</span><span class=p>.</span><span class=nx>port</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>socket</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;connect&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>socket</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;my event&#39;</span><span class=p>,</span> <span class=p>{</span><span class=nx>data</span><span class=o>:</span> <span class=s1>&#39;I\&#39;m connected!&#39;</span><span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=err>/script&gt;</span>
</span></span></code></pre></div><h2 id=3æ¥æ”¶æ¶ˆæ¯>3.æ¥æ”¶æ¶ˆæ¯<a hidden class=anchor aria-hidden=true href=#3æ¥æ”¶æ¶ˆæ¯>#</a></h2><p>ä½¿ç”¨SocketIOæ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä»¥äº‹ä»¶çš„æ–¹å¼æ¥æ”¶æ¶ˆæ¯-äº‹ä»¶é©±åŠ¨ã€‚åœ¨å®¢æˆ·ç«¯ï¼Œjavascriptä½¿ç”¨å›è°ƒå‡½æ•°ã€‚åœ¨æœåŠ¡ç«¯ï¼ŒFlask-SocketIOéœ€è¦æ³¨å†Œäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç±»ä¼¼äºè·¯ç”±-è§†å›¾å‡½æ•°æœºåˆ¶ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­åˆ›å»ºæœåŠ¡ç«¯æ— åäº‹ä»¶å¤„ç†å‡½æ•°ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@socketio.on</span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_message</span><span class=p>(</span><span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;received message: &#39;</span> <span class=o>+</span> <span class=n>message</span><span class=p>)</span>
</span></span></code></pre></div><p>ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨å­—ç¬¦ä¸²æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨jsonæ ¼å¼çš„æ¶ˆæ¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@socketio.on</span><span class=p>(</span><span class=s1>&#39;json&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_json</span><span class=p>(</span><span class=n>json</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;received json: &#39;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>json</span><span class=p>))</span>
</span></span></code></pre></div><p>æœ€çµæ´»çš„äº‹ä»¶ç±»å‹æ˜¯ä½¿ç”¨å®šåˆ¶äº‹ä»¶åç§°ã€‚è¿™äº›äº‹ä»¶çš„æ¶ˆæ¯æ•°æ®æ ¼å¼å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€å­—èŠ‚ã€æ•´æ•°æˆ–è€…jsonï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@socketio.on</span><span class=p>(</span><span class=s1>&#39;my event&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_my_custom_event</span><span class=p>(</span><span class=n>json</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;received json: &#39;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>json</span><span class=p>))</span>
</span></span></code></pre></div><p>å®šåˆ¶çš„å‘½åäº‹ä»¶æ”¯æŒå¤šå‚æ•°ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@socketio.on</span><span class=p>(</span><span class=s1>&#39;my event&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_my_custom_event</span><span class=p>(</span><span class=n>arg1</span><span class=p>,</span> <span class=n>arg2</span><span class=p>,</span> <span class=n>arg3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;received args: &#39;</span> <span class=o>+</span> <span class=n>arg1</span> <span class=o>+</span> <span class=n>arg2</span> <span class=o>+</span> <span class=n>arg3</span><span class=p>)</span>
</span></span></code></pre></div><p>å‘½åäº‹ä»¶æ˜¯æœ€çµæ´»çš„ï¼Œå› ä¸ºå‘½åäº‹ä»¶æ¶ˆé™¤äº†åŒ…å«é™„åŠ å…ƒæ•°æ®ï¼ˆæè¿°æ¶ˆæ¯ç±»å‹ï¼‰çš„éœ€è¦ã€‚Flask-socketIOä¹Ÿæ”¯æŒSocketIOå‘½ååŸŸï¼ŒSocketIOå‘½ååŸŸå…è®¸å®¢æˆ·ç«¯å¤ç”¨socketï¼ˆå¤šä¸ªè¿æ¥å»ºç«‹åœ¨åŒä¸€ç‰©ç†socketï¼‰ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@socketio.on</span><span class=p>(</span><span class=s1>&#39;my event&#39;</span><span class=p>,</span> <span class=n>namespace</span><span class=o>=</span><span class=s1>&#39;/test&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_my_custom_namespace_event</span><span class=p>(</span><span class=n>json</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;received json: &#39;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>json</span><span class=p>))</span>
</span></span></code></pre></div><p>å½“SocketIOæ²¡æœ‰æ˜¾å¼æŒ‡å®šå‘½ååŸŸï¼Œå…¨å±€å‘½ååŸŸâ€˜ï¼â€™å°†ä¼šè¢«ä½¿ç”¨ã€‚</p><p>å½“è£…é¥°å™¨è¯­æ³•ä¸å¤ªåˆé€‚æ—¶ï¼Œon_eventæ–¹æ³•å¯è¢«ä½¿ç”¨ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>my_function_handler</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>socketio</span><span class=o>.</span><span class=n>on_event</span><span class=p>(</span><span class=s1>&#39;my event&#39;</span><span class=p>,</span> <span class=n>my_function_handler</span><span class=p>,</span> <span class=n>namespace</span><span class=o>=</span><span class=s1>&#39;/test&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>å®¢æˆ·ç«¯å¯èƒ½è¯·æ±‚ä¸€ä¸ªæ‰¿è®¤çš„å›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°ç¡®è®¤æ¥æ”¶å‘é€çš„æ¶ˆæ¯ã€‚å¤„ç†å‡½æ•°çš„ä»»ä½•è¿”å›å€¼å°†ä¼šä½œä¸ºå‚æ•°é€’é€ç»™å®¢æˆ·ç«¯çš„å›è°ƒå‡½æ•°ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=err>@</span><span class=n>socketio</span><span class=p>.</span><span class=nf>on</span><span class=p>(</span><span class=err>&#39;</span><span class=n>my</span> <span class=n>event</span><span class=err>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>def</span> <span class=nf>handle_my_custom_event</span><span class=p>(</span><span class=n>json</span><span class=p>)</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=nf>print</span><span class=p>(</span><span class=err>&#39;</span><span class=n>received</span> <span class=nl>json</span><span class=p>:</span> <span class=err>&#39;</span> <span class=o>+</span> <span class=nf>str</span><span class=p>(</span><span class=n>json</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=err>&#39;</span><span class=n>one</span><span class=err>&#39;</span><span class=p>,</span> <span class=mi>2</span>
</span></span></code></pre></div><p>ä¸Šä¾‹ä¸­ï¼Œå®¢æˆ·ç«¯å›è°ƒå‡½æ•°å°†ä¼šè¢«ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼šâ€˜one&rsquo;å’Œ2ã€‚</p><h2 id=4å‘é€æ¶ˆæ¯>4ã€å‘é€æ¶ˆæ¯<a hidden class=anchor aria-hidden=true href=#4å‘é€æ¶ˆæ¯>#</a></h2><p>Socket IOäº‹ä»¶å¤„ç†å‡½æ•°å¯ä»¥å‘é€å›å¤æ¶ˆæ¯è‡³è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæ–¹æ³•åŒ…æ‹¬send()å’Œemit()ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask_socketio</span> <span class=kn>import</span> <span class=n>send</span><span class=p>,</span> <span class=n>emit</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@socketio.on</span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_message</span><span class=p>(</span><span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>send</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@socketio.on</span><span class=p>(</span><span class=s1>&#39;json&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_json</span><span class=p>(</span><span class=n>json</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>send</span><span class=p>(</span><span class=n>json</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@socketio.on</span><span class=p>(</span><span class=s1>&#39;my event&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_my_custom_event</span><span class=p>(</span><span class=n>json</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>emit</span><span class=p>(</span><span class=s1>&#39;my response&#39;</span><span class=p>,</span> <span class=n>json</span><span class=p>)</span>
</span></span></code></pre></div><p>å½“ä½¿ç”¨å‘½ååŸŸæ—¶ï¼Œsendå’Œemité»˜è®¤ä½¿ç”¨æ¥æ”¶æ¶ˆæ¯çš„å‘½ååŸŸã€‚ä¸åŒçš„å‘½ååŸŸå¯ä»¥é€šè¿‡namespaceå‚æ•°æŒ‡å®šã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@socketio.on</span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_message</span><span class=p>(</span><span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>send</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>namespace</span><span class=o>=</span><span class=s1>&#39;/chat&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@socketio.on</span><span class=p>(</span><span class=s1>&#39;my event&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_my_custom_event</span><span class=p>(</span><span class=n>json</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>emit</span><span class=p>(</span><span class=s1>&#39;my response&#39;</span><span class=p>,</span> <span class=n>json</span><span class=p>,</span> <span class=n>namespace</span><span class=o>=</span><span class=s1>&#39;/chat&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>å½“ä½¿ç”¨å¤šä¸ªå‚æ•°å›å¤ä¸€ä¸ªäº‹ä»¶æ—¶ï¼Œå‘é€ä¸€ä¸ªtupleï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@socketio.on</span><span class=p>(</span><span class=s1>&#39;my event&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_my_custom_event</span><span class=p>(</span><span class=n>json</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>emit</span><span class=p>(</span><span class=s1>&#39;my response&#39;</span><span class=p>,</span> <span class=p>(</span><span class=s1>&#39;foo&#39;</span><span class=p>,</span> <span class=s1>&#39;bar&#39;</span><span class=p>,</span> <span class=n>json</span><span class=p>),</span> <span class=n>namespace</span><span class=o>=</span><span class=s1>&#39;/chat&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>SocketIOæ”¯æŒå›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°ç”¨äºè¯å®å®¢æˆ·ç«¯æˆåŠŸæ¥æ”¶äº†æ¶ˆæ¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>ack</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span> <span class=s1>&#39;message was received!&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@socketio.on</span><span class=p>(</span><span class=s1>&#39;my event&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_my_custom_event</span><span class=p>(</span><span class=n>json</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>emit</span><span class=p>(</span><span class=s1>&#39;my response&#39;</span><span class=p>,</span> <span class=n>json</span><span class=p>,</span> <span class=n>callback</span><span class=o>=</span><span class=n>ack</span><span class=p>)</span>
</span></span></code></pre></div><p>å½“ä½¿ç”¨å›è°ƒå‡½æ•°æ—¶ï¼Œjså®¢æˆ·ç«¯ä»æ¥æ”¶çš„æ¶ˆæ¯ä¸­è·å–å›è°ƒå‡½æ•°ï¼Œå®¢æˆ·ç«¯å›è°ƒå‡½æ•°å”¤èµ·ä¹‹åæœåŠ¡ç«¯çš„å›è°ƒå‡½æ•°ç›¸åº”åœ°è¢«å”¤èµ·ã€‚å¦‚æ­Œå®¢æˆ·ç«¯å›è°ƒå‡½æ•°å…·æœ‰å‚æ•°ï¼ŒæœåŠ¡ç«¯çš„å›è°ƒå‡½æ•°å…·æœ‰ç›¸åŒçš„å‚æ•°ã€‚</p><h2 id=5å¹¿æ’­>5ã€å¹¿æ’­<a hidden class=anchor aria-hidden=true href=#5å¹¿æ’­>#</a></h2><p>Flask-SocketIOæ”¯æŒå¹¿æ’­ï¼Œåªéœ€åœ¨sendå’Œemitå‡½æ•°ä¸­æ·»åŠ å…³é”®å­—å‚æ•°broadcast=Trueï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@socketio.on</span><span class=p>(</span><span class=s1>&#39;my event&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_my_custom_event</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>emit</span><span class=p>(</span><span class=s1>&#39;my response&#39;</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=n>broadcast</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></div><p>å¯¹äºæœåŠ¡ç«¯ä¸»åŠ¨å‘èµ·çš„å¹¿æ’­ï¼Œsocketio.send()å’Œsocketio.emit()æ–¹æ³•å¯ä»¥ç”¨æ¥å¹¿æ’­æ¶ˆæ¯è‡³æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>some_function</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>socketio</span><span class=o>.</span><span class=n>emit</span><span class=p>(</span><span class=s1>&#39;some event&#39;</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;data&#39;</span><span class=p>:</span> <span class=mi>42</span><span class=p>})</span>
</span></span></code></pre></div><h2 id=6rooms>6ã€Rooms<a hidden class=anchor aria-hidden=true href=#6rooms>#</a></h2><p>Flask-SocketIOé€šè¿‡join_roomå’Œleave_roomå‡½æ•°æ”¯æŒroomæ¦‚å¿µã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask_socketio</span> <span class=kn>import</span> <span class=n>join_room</span><span class=p>,</span> <span class=n>leave_room</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@socketio.on</span><span class=p>(</span><span class=s1>&#39;join&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>on_join</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>username</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>room</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;room&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>join_room</span><span class=p>(</span><span class=n>room</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>send</span><span class=p>(</span><span class=n>username</span> <span class=o>+</span> <span class=s1>&#39; has entered the room.&#39;</span><span class=p>,</span> <span class=n>room</span><span class=o>=</span><span class=n>room</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@socketio.on</span><span class=p>(</span><span class=s1>&#39;leave&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>on_leave</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>username</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>room</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;room&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>leave_room</span><span class=p>(</span><span class=n>room</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>send</span><span class=p>(</span><span class=n>username</span> <span class=o>+</span> <span class=s1>&#39; has left the room.&#39;</span><span class=p>,</span> <span class=n>room</span><span class=o>=</span><span class=n>room</span><span class=p>)</span>
</span></span></code></pre></div><p>sendå’Œemitå‡½æ•°æ¥æ”¶å…³é”®å­—å‚æ•°roomï¼Œå°†æ¶ˆæ¯å‘é€è‡³è¿æ¥å¯¹åº”roomçš„å®¢æˆ·ç«¯ã€‚</p><p>æ‰€æœ‰çš„å®¢æˆ·ç«¯è¿æ¥roomæ—¶ç”¨session IDå‘½åï¼Œå¯ä»¥ä½¿ç”¨request.sidè·å–ã€‚</p><h2 id=7è¿æ¥äº‹ä»¶>7ã€è¿æ¥äº‹ä»¶<a hidden class=anchor aria-hidden=true href=#7è¿æ¥äº‹ä»¶>#</a></h2><p>Flask-SocketIOä¹Ÿæ”¯æŒè¿æ¥å’Œè¿æ¥æ–­å¼€äº‹ä»¶ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@socketio.on</span><span class=p>(</span><span class=s1>&#39;connect&#39;</span><span class=p>,</span> <span class=n>namespace</span><span class=o>=</span><span class=s1>&#39;/chat&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_connect</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>emit</span><span class=p>(</span><span class=s1>&#39;my response&#39;</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;data&#39;</span><span class=p>:</span> <span class=s1>&#39;Connected&#39;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@socketio.on</span><span class=p>(</span><span class=s1>&#39;disconnect&#39;</span><span class=p>,</span> <span class=n>namespace</span><span class=o>=</span><span class=s1>&#39;/chat&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_disconnect</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Client disconnected&#39;</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=8åŸºäºç±»çš„å‘½ååŸŸ>8ã€åŸºäºç±»çš„å‘½ååŸŸ<a hidden class=anchor aria-hidden=true href=#8åŸºäºç±»çš„å‘½ååŸŸ>#</a></h2><p>ä¸Šé¢æè¿°çš„æ˜¯åŸºäºè£…é¥°å™¨çš„å¤„ç†å‡½æ•°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŸºäºç±»çš„å‘½ååŸŸå¤„ç†å‡½æ•°ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask_socketio</span> <span class=kn>import</span> <span class=n>Namespace</span><span class=p>,</span> <span class=n>emit</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MyCustomNamespace</span><span class=p>(</span><span class=n>Namespace</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>on_connect</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>on_disconnect</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>on_my_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>emit</span><span class=p>(</span><span class=s1>&#39;my_response&#39;</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>socketio</span><span class=o>.</span><span class=n>on_namespace</span><span class=p>(</span><span class=n>MyCustomNamespace</span><span class=p>(</span><span class=s1>&#39;/test&#39;</span><span class=p>))</span>
</span></span></code></pre></div><h2 id=9é”™è¯¯å¤„ç†>9ã€é”™è¯¯å¤„ç†<a hidden class=anchor aria-hidden=true href=#9é”™è¯¯å¤„ç†>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@socketio.on_error</span><span class=p>()</span>        <span class=c1># Handles the default namespace</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>error_handler</span><span class=p>(</span><span class=n>e</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@socketio.on_error</span><span class=p>(</span><span class=s1>&#39;/chat&#39;</span><span class=p>)</span> <span class=c1># handles the &#39;/chat&#39; namespace</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>error_handler_chat</span><span class=p>(</span><span class=n>e</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@socketio.on_error_default</span>  <span class=c1># handles all namespaces without an explicit error handler</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>default_error_handler</span><span class=p>(</span><span class=n>e</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://solaim.github.io/tags/python/>Python</a></li><li><a href=https://solaim.github.io/tags/flask/>Flask</a></li><li><a href=https://solaim.github.io/tags/socketio/>SocketIO</a></li></ul><nav class=paginav><a class=prev href=https://solaim.github.io/posts/rabbitmq%E5%AE%89%E8%A3%85%E5%92%8C%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/><span class=title>Â« Prev</span><br><span>RabbitMQå®‰è£…å’ŒåŸºæœ¬æ¦‚å¿µ</span>
</a><a class=next href=https://solaim.github.io/posts/%E6%9C%80%E5%A5%BD%E7%9A%84%E5%91%8A%E5%88%AB/><span class=title>Next Â»</span><br><span>æœ€å¥½çš„å‘Šåˆ«</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://solaim.github.io/>Jerry Wang</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>