<!doctype html><html lang=en dir=auto><head><meta name=generator content="Hugo 0.147.2"><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Jerry Wang</title>
<meta name=keywords content="Blog,Portfolio,PaperMod"><meta name=description content="Jerry Wang's Personal Blog"><meta name=author content="Jerry Wang"><link rel=canonical href=https://solaim.github.io/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://solaim.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://solaim.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://solaim.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://solaim.github.io/apple-touch-icon.png><link rel=mask-icon href=https://solaim.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://solaim.github.io/index.xml><link rel=alternate hreflang=en href=https://solaim.github.io/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://solaim.github.io/"><meta property="og:site_name" content="Jerry Wang"><meta property="og:title" content="Jerry Wang"><meta property="og:description" content="Jerry Wang's Personal Blog"><meta property="og:locale" content="en-us"><meta property="og:type" content="website"><meta property="og:image" content="https://solaim.github.io/img/favicon.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://solaim.github.io/img/favicon.webp"><meta name=twitter:title content><meta name=twitter:description content="Jerry Wang's Personal Blog"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"Jerry Wang","url":"https://solaim.github.io/","description":"Jerry Wang's Personal Blog","logo":"https://solaim.github.io/favicon.ico","sameAs":["https://github.com/solaim"]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://solaim.github.io/ accesskey=h title="é¦–é¡µ (Alt + H)"><img src=https://solaim.github.io/apple-touch-icon.png alt aria-label=logo height=35>é¦–é¡µ</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://solaim.github.io/categories/ title=ğŸ•¸åˆ†ç±»><span>ğŸ•¸åˆ†ç±»</span></a></li><li><a href=https://solaim.github.io/tags/ title=ğŸšæ ‡ç­¾><span>ğŸšæ ‡ç­¾</span></a></li><li><a href=https://solaim.github.io/about/ title=ğŸŒå…³äº><span>ğŸŒå…³äº</span></a></li></ul></nav></header><main class=main><article class="first-entry home-info"><header class=entry-header><h1>Jerry Wang&rsquo;s Personal Blog</h1></header><div class=entry-content>â˜€ï¸ç™½é©¹è¿‡éš™,æ—¶å…‰èè‹’ğŸŒ›</div><footer class=entry-footer><div class=social-icons><a href=https://github.com/solaim target=_blank rel="noopener noreferrer me" title=Github><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></div></footer></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Difyå®ç°åŠæ€è€ƒ</h2></header><div class=entry-content><p>å®ç° Difyå‰ç«¯ä½¿ç”¨Reactæ¡†æ¶å®ç°ï¼Œè¿™é‡Œä¸åšæ·±å…¥æ¢ç´¢ï¼Œæ¥çœ‹çœ‹åç«¯çš„å®ç°ã€‚
ä¸»è¦ä»£ç ç›®å½•å¦‚ä¸‹ï¼š
.\ ..\ api\ # åç«¯å®ç°ç›®å½• app.py # å…¥å£æ–‡ä»¶ controllers\ # æ§åˆ¶å±‚ï¼Œæ³¨å†Œè·¯ç”± console\ # å‰ç«¯API files\ # å›¾ç‰‡ã€æ–‡ä»¶API inner_api\ # æ’ä»¶API service_api\ web\ services\ # ä¸šåŠ¡å®ç°å±‚ models\ # æ¨¡å‹ core\ # é€»è¾‘å®ç° web\ # å‰ç«¯å®ç°ç›®å½• åç«¯æ¡†æ¶ä½¿ç”¨Flaskï¼Œä½¿ç”¨flask-restfulç®¡ç†è·¯ç”±ï¼Œä½¿ç”¨celeryè¿›è¡Œåˆ†å¸ƒå¼ä»»åŠ¡ç®¡ç†ã€‚
æ¶æ„å±‚é¢ï¼š
API server &lt;â€“> Worker
ä¸ºäº†æ”¯æŒæ¨ªå‘æ‰©å±•ï¼Œå¯ä»¥å¤šèŠ‚ç‚¹éƒ¨ç½²workerï¼Œå±äºåŸºäºäº‹ä»¶é©±åŠ¨çš„æ¶æ„ã€‚
å®ç°å±‚é¢ï¼š
åˆ†å±‚æ¶æ„ï¼Œç»å…¸çš„æ§åˆ¶ã€æœåŠ¡ã€æ¨¡å‹åˆ†å±‚ã€‚
æ•°æ®åº“ï¼š
ä¸šåŠ¡ç®¡ç†ä½¿ç”¨çš„pgï¼Œæ˜¯é™¤MySQLå¤–å¾ˆæµè¡Œçš„å¼€æºå…³ç³»å‹æ•°æ®åº“ã€‚
ä¸ºæ”¯æŒRAGï¼Œdifyæ”¯æŒäº†å¾ˆå¤šæ¬¾å‘é‡æ•°æ®åº“ï¼Œå¯ä»¥æŒ‰éœ€é…ç½®ã€‚
éƒ¨ç½²ï¼š docker compose ä¸€è¡Œå‘½ä»¤å®Œæˆéƒ¨ç½²ï¼Œå¿«é€Ÿä½“éªŒå¾ˆèµã€‚
æ€è€ƒ ç¿»çœ‹difyçš„æºç ï¼Œæœ‰ç§ç†Ÿæ‚‰çš„æ„Ÿè§‰ï¼Œå› ä¸ºè¿™å°±æ˜¯ç¬¬ä¸€ä»½å·¥ä½œçš„å®Œæ•´æŠ€æœ¯æ ˆã€‚
ä½œä¸ºæŠ€æœ¯å¼€å‘è€…ï¼Œè¿½é€æ–°é¢–ã€æ—¶é«¦çš„æŠ€æœ¯ï¼Œè®¤ä¸ºè¿™äº›å¾ˆé…·ï¼Œä½†æ˜¯æœ‰æ—¶å€™ä¼šå¿˜äº†å‡ºå‘ç‚¹ï¼š
æŠ€æœ¯æ˜¯ç”¨æ¥è§£å†³é—®é¢˜çš„ï¼
Difyç›®å‰å·²ç»å°†è¿‘96Kçš„starã€‚</p></div><footer class=entry-footer><span title='2025-05-08 14:23:49 +0800 +0800'>2025-05-08</span>&nbsp;Â·&nbsp;Jerry Wang</footer><a class=entry-link aria-label="post link to Difyå®ç°åŠæ€è€ƒ" href=https://solaim.github.io/posts/dify%E5%AE%9E%E7%8E%B0%E5%8F%8A%E6%80%9D%E8%80%83/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>AI agentå®æˆ˜</h2></header><div class=entry-content><p>AI agentæ¡†æ¶ä¼—å¤šï¼Œæœ¬æ–‡é€‰æ‹©Difyå¹³å°ï¼Œæ¥ä¸€æ³¢AI agentå¼€å‘å®æˆ˜ï¼
éƒ¨ç½² git clone https://github.com/langgenius/dify.git cd dify/docker # å›½å†…docker hubè®¿é—®å—é™ï¼Œå»ºè®®ä½¿ç”¨ä»£ç† # è¯·ä½¿ç”¨æ–°ç‰ˆæœ¬docker docker compose up -d ä½¿ç”¨ è®¿é—®127.0.0.1ï¼Œé¡µé¢æ­£å¸¸å¯è®¾ç½®ç®¡ç†å‘˜å¹¶ç™»é™†ï¼š
ç™»é™†å®Œæˆï¼Œè¿›å…¥å·¥ä½œå®¤ï¼š
æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹æ­å»ºä¸€ä¸ªä¼ä¸šç§æœ‰çš„AI agentã€‚
ç®¡ç†æ¨¡å‹ æ·»åŠ æ¨¡å‹ä¾›åº”å•†
ä¿®æ”¹ç³»ç»Ÿæ¨¡å‹é…ç½®
æœ¬æ–‡ä½¿ç”¨ç«å±±æ–¹èˆŸçš„deepseekå’Œdoubao embeddingæ¨¡å‹ï¼Œå¯ä»¥åœ¨ç«å±±æ–¹èˆŸæ§åˆ¶å°åœ¨çº¿æ¨ç†é¡µé¢å¼€é€šã€‚
ç®¡ç†çŸ¥è¯†åº“ ä¸Šä¼ æ–‡æ¡£ï¼Œé€‰æ‹©embeddingæ¨¡å‹ï¼Œè¿›è¡ŒçŸ¥è¯†å…¥åº“ã€‚
é…ç½®Agent åœ¨çŸ¥è¯†åº“æ·»åŠ é¢è¯•èµ„æ–™æ–‡æ¡£çŸ¥è¯†åº“ï¼Œè¿›è¡ŒèŠå¤©å³å¯ä½¿ç”¨äº†ã€‚
å‘å¸ƒ difyæä¾›å‘å¸ƒåŠŸèƒ½ï¼Œå¯ä»¥å‘å¸ƒå•ç‹¬çš„é¡µé¢æˆ–åµŒå…¥å…¶ä»–é¡µé¢ï¼Œæ–¹ä¾¿ä½¿ç”¨ã€‚
difyä¹Ÿæ”¯æŒworkflowï¼Œæ¯”å•ç‹¬çš„agentæ›´å¼ºå¤§ã€‚</p></div><footer class=entry-footer><span title='2025-05-07 15:05:08 +0800 +0800'>2025-05-07</span>&nbsp;Â·&nbsp;Jerry Wang</footer><a class=entry-link aria-label="post link to AI agentå®æˆ˜" href=https://solaim.github.io/posts/ai_agent%E5%AE%9E%E6%88%98/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>AI Agentçºµè§ˆ</h2></header><div class=entry-content><p>AI Agentæœ€è¿‘ä¸¤ä¸‰å¹´å¼‚å¸¸ç«çƒ­ï¼Œä¸‹é¢ğŸ‘‡æ˜¯æŸå¤´éƒ¨å…¬å¸çš„AI Agentå¼€å‘å²—çš„JDï¼š
å²—ä½èŒè´£
1ã€è´Ÿè´£å¤§æ¨¡å‹åº”ç”¨å¼€å‘èŒƒå¼åŠä¸€ç«™å¼ç ”å‘å¹³å°çš„è®¾è®¡ã€å¼€å‘åŠåº”ç”¨ï¼Œæ”¯æŒå…¬å¸å†…éƒ¨å¤§æ¨¡å‹çš„åº”ç”¨çš„å¿«é€Ÿè½åœ°
2ã€è´Ÿè´£å¤§æ¨¡å‹äº§å“çš„æ•´ä½“æŠ€æœ¯è§£å†³æ–¹æ¡ˆï¼Œå¹¶æ”¯æŒæŠ€æœ¯ç ”å‘å’Œæ•ˆæœä¼˜åŒ–ç­‰å·¥ä½œï¼Œæ¨åŠ¨äº§å“æŒç»­å¢é•¿
3ã€ä¿éšœå¤§æ¨¡å‹åº”ç”¨ç³»ç»Ÿæ¶æ„çš„ç¨³å®šã€é«˜æ•ˆè¿è¡Œï¼Œå¸®åŠ©ä¸šåŠ¡ä¼˜åŒ–æ€§èƒ½å’Œæ”¹å–„ç³»ç»Ÿç¨³å®šæ€§
èŒä½æè¿°
1ã€è®¡ç®—æœºæˆ–ç›¸å…³ä¸“ä¸šæœ¬ç§‘åŠä»¥ä¸Šå­¦å†ï¼Œ2å¹´ä»¥ä¸Šå·¥ä½œç»éªŒï¼Œç†Ÿç»ƒæŒæ¡Pythonï¼Œæˆ–è‡³å°‘ä¸€é—¨ä¸»æµå¼€å‘è¯­è¨€ã€‚
2ã€æœ‰Agentå¹³å°/åº”ç”¨å¼€å‘ç»éªŒè€…ä¼˜å…ˆï¼Œç†Ÿæ‚‰cozeï¼Œdifyï¼Œlangflowç­‰å¼€å‘å¹³å°ï¼Œäº†è§£RAGã€Agentæœºåˆ¶ï¼Œä½¿ç”¨è¿‡langchainç­‰å¼€æºç³»ç»Ÿï¼Œæœ‰promptå·¥ç¨‹ä¸šåŠ¡ä¼˜åŒ–ç»éªŒè€…ä¼˜å…ˆã€‚
3ã€æœ‰æ¯”è¾ƒæ•é”çš„äº§å“æ„è¯†å’Œæ•°æ®åˆ†æèƒ½åŠ›ã€‚
4ã€æœ‰ä¼˜ç§€çš„æ¶æ„è®¾è®¡èƒ½åŠ›ï¼Œäº†è§£åŒ…æ‹¬æ£€ç´¢å¼•æ“ã€kvå­˜å‚¨ã€åœ¨çº¿åº”ç”¨æ¡†æ¶ã€æ‰¹æµå¤„ç†ç­‰ä¸­é—´ä»¶ç³»ç»Ÿï¼Œæœ‰æ‰¿æ‹…è¿‡åƒä¸‡çº§ä»¥ä¸Šäº§å“åº”ç”¨æ¶æ„è®¾è®¡è€…ä¼˜å…ˆã€‚
ä»ä¸Šé¢çš„JDå¯ä»¥æå–çš„ä¿¡æ¯ï¼š
å¼€å‘è¯­è¨€ï¼šPython(C++ã€Golangéœ€æ±‚ä¹Ÿè¾ƒå¤š) æ¡†æ¶ï¼šdifyã€langflowç­‰ åŸç†ï¼šRAGã€Agentå·¥ä½œåŸç† åç«¯åŸºç¡€ç»„ä»¶ AI Agent AI Agentï¼ˆä¹Ÿç§°äººå·¥æ™ºèƒ½ä»£ç†ã€æ™ºèƒ½ä½“ï¼‰æ˜¯ä¸€ç§èƒ½å¤Ÿæ„ŸçŸ¥ç¯å¢ƒã€è¿›è¡Œå†³ç­–å’Œæ‰§è¡ŒåŠ¨ä½œçš„æ™ºèƒ½å®ä½“ã€‚æ™ºèƒ½ä½“åƒäººä¸€æ ·ï¼Œå®ƒæœ‰è®°å¿†ã€æœ‰é€»è¾‘åˆ†æèƒ½åŠ›ã€æœ‰ä»»åŠ¡çš„æ‹†è§£èƒ½åŠ›ã€é—®é¢˜çš„æ‹†è§£èƒ½åŠ›å’Œæœ€åç»¼åˆå›æ¥ç»Ÿä¸€è§£å†³é—®é¢˜çš„èƒ½åŠ›ã€‚
æ™ºèƒ½ä½“çš„ç»„æˆï¼š
Iï¼šè¾“å…¥ï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­çš„æ„ŸçŸ¥Perceptionï¼ŒåŒ…æ‹¬æ–‡æœ¬ã€å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ç­‰ Oï¼šè¾“å‡ºï¼Œå³ä¸Šå›¾ä¸­çš„è¡ŒåŠ¨Actionï¼ŒåŒ…æ‹¬è¾“å‡ºæ–‡æœ¬åŠè°ƒç”¨å·¥å…·ç­‰ Bï¼šå¤§è„‘Brainï¼ŒåŸºäºLLMï¼Œå…·æœ‰çŸ¥è¯†ã€è®°å¿†ã€æ¨ç†ã€è§„åˆ’ç­‰åŠŸèƒ½ æ™ºèƒ½ä½“çš„å½¢å¼ï¼š
å•Agentï¼šå•ä¸ªAgentå®Œæˆä»»åŠ¡ å¤šAgentï¼šå¤šä¸ªAgenté…åˆå®Œæˆä»»åŠ¡ RAG æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRetrieval Augmented Generationï¼‰ï¼Œç®€ç§° RAGã€‚
ä¸ºä»€ä¹ˆä¼šæœ‰RAGï¼Ÿ
è§£å†³çŸ¥è¯†ç¼ºå¤±é—®é¢˜ï¼šå¤§æ¨¡å‹çš„çŸ¥è¯†å›ºå®šåœ¨è®­ç»ƒçš„æ•°æ®ä¸Šï¼Œæ— æ³•è·å–æœ€æ–°èµ„è®¯ã€‚ è§£å†³å¿«é—®ä¹±ç­”é—®é¢˜ï¼šå¤§æ¨¡å‹æœ‰å¹»è§‰é—®é¢˜ï¼Œè¶…å‡ºèŒƒå›´çš„ç­”æ¡ˆä¸é è°±ã€‚ è§£å†³æ•°æ®å®‰å…¨é—®é¢˜ï¼šä¼ä¸šä¸“æœ‰èµ„æ–™ï¼Œä¸èƒ½ä¸¢ç»™é€šç”¨å¤§æ¨¡å‹å»è®­ç»ƒã€‚ å®ç°è·¯å¾„ï¼š
**
å°†çŸ¥è¯†å‘é‡åŒ–ï¼šçŸ¥è¯†é€šè¿‡embeddingå­˜å‚¨åœ¨å‘é‡æ•°æ®åº“ å®¢æˆ·æ£€ç´¢ï¼šé—®é¢˜embeddingï¼Œæ£€ç´¢å‘é‡æ•°æ®åº“ï¼Œç”Ÿæˆæç¤ºè¯ æŠ•å–‚LLMï¼šå°†ä¸Šé¢ç”Ÿæˆçš„æç¤ºè¯å–‚ç»™LLMç”Ÿæˆæœ€ç»ˆçš„ç­”æ¡ˆ MCP Model Context Protocolï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰æ˜¯ Anthropic åœ¨æ¨å‡ºçš„ç”¨äº LLM åº”ç”¨å’Œå¤–éƒ¨æ•°æ®æºï¼ˆResourcesï¼‰æˆ–å·¥å…·ï¼ˆToolsï¼‰é€šä¿¡çš„æ ‡å‡†åè®®ï¼Œéµå¾ª JSON-RPC 2.0 çš„åŸºç¡€æ¶ˆæ¯æ ¼å¼ã€‚
MCPéµå¾ªCSæ¶æ„ï¼Œåº”ç”¨åŒ…æ‹¬clientï¼Œclientè´Ÿè´£å’Œserveré€šä¿¡ã€‚
æ ¸å¿ƒæ¦‚å¿µï¼š
èµ„æºï¼šMCP æœåŠ¡å™¨å¸Œæœ›æä¾›ç»™å®¢æˆ·ç«¯çš„ä»»ä½•ç±»å‹çš„æ•°æ® æç¤ºè¯ï¼šMCP æœåŠ¡å™¨èƒ½å¤Ÿå®šä¹‰å¯é‡ç”¨çš„æç¤ºæ¨¡æ¿å’Œå·¥ä½œæµ å·¥å…·ï¼šä½¿æœåŠ¡å™¨èƒ½å¤Ÿå‘å®¢æˆ·ç«¯å…¬å¼€å¯æ‰§è¡ŒåŠŸèƒ½ã€‚é€šè¿‡å·¥å…·ï¼ŒLLM å¯ä»¥ä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’ï¼Œæ‰§è¡Œè®¡ç®—ï¼Œå¹¶åœ¨çœŸå®çš„ä¸–ç•Œä¸­é‡‡å–è¡ŒåŠ¨ã€‚ é‡‡æ ·ï¼šæœåŠ¡å™¨é€šè¿‡å®¢æˆ·ç«¯è¯·æ±‚ LLM æ ¹ï¼šå®šä¹‰äº†æœåŠ¡å™¨å¯ä»¥æ“ä½œçš„è¾¹ç•Œ è¯¦ç»†æ–‡æ¡£è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£
...</p></div><footer class=entry-footer><span title='2025-05-07 10:29:29 +0800 +0800'>2025-05-07</span>&nbsp;Â·&nbsp;Jerry Wang</footer><a class=entry-link aria-label="post link to AI Agentçºµè§ˆ" href=https://solaim.github.io/posts/ai_agent%E7%BA%B5%E8%A7%88/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>ROS2æ¶æ„å’Œå®ç°</h2></header><div class=entry-content><p>ROS2æ˜¯æœºå™¨äººé¢†åŸŸçš„è‘—åSDKï¼Œå¯ä»¥åŠ é€Ÿå­¦ä¹ æ•ˆç‡ã€‚ROS2ä¸»è¦è§£å†³äº†ä¸¤ä¸ªé—®é¢˜ï¼š
é€šä¿¡ï¼šåŸºäºNodeï¼ŒåŒ…å«topicã€serviceã€actioné€šä¿¡æ–¹å¼ ä»£ç æ¶æ„ï¼šæ¨¡å—åŒ–å¼€å‘ï¼Œç®€åŒ–ç»´æŠ¤ ä¸€ã€æ¶æ„ userland: code
client: rclc rclcpp rclpy etcâ€¦
abstract: rcl
middleware: rmw rmw_implementation rmw_fastrtps etc â€¦
dds: fastdds Context_RTI etcâ€¦
äºŒã€å®ç° ROS2ä»£ç æƒ¯ä¾‹ï¼š
./ ../ include/... # å¤´æ–‡ä»¶ src/... # å®ç° 1ã€Nodeå®ç° æ¨èç»§æ‰¿Nodeå®ç°ä¸šåŠ¡åŠŸèƒ½, ä¸»è¦é€‰æ‹©åˆç†çš„é€šä¿¡æ–¹å¼ï¼Œæ³¨å†Œå›è°ƒå‡½æ•°ã€‚
namespace palomino { class VincentDriver : public rclcpp::Node { // ... }; } int main(int argc, char * argv[]) { rclcpp::init(argc, argv); rclcpp::spin(std::make_shared&lt;palomino::VincentDriver>()); rclcpp::shutdown(); return 0; } Nodeçš„å£°æ˜ï¼š
// node.hpp class Node : public std::enable_shared_from_this&lt;Node> { public: explicit Node( const std::string & node_name, const NodeOptions & options = NodeOptions()); explicit Node( const std::string & node_name, const std::string & namespace_, const NodeOptions & options = NodeOptions()); virtual ~Node(); // åˆ›å»ºå‘å¸ƒè€… template&lt; typename MessageT, typename AllocatorT = std::allocator&lt;void>, typename PublisherT = rclcpp::Publisher&lt;MessageT, AllocatorT>> std::shared_ptr&lt;PublisherT> create_publisher( const std::string & topic_name, const rclcpp::QoS & qos, const PublisherOptionsWithAllocator&lt;AllocatorT> & options = PublisherOptionsWithAllocator&lt;AllocatorT>() ); // åˆ›å»ºè®¢é˜…è€… template&lt; typename MessageT, typename CallbackT, typename AllocatorT = std::allocator&lt;void>, typename SubscriptionT = rclcpp::Subscription&lt;MessageT, AllocatorT>, typename MessageMemoryStrategyT = typename SubscriptionT::MessageMemoryStrategyType > std::shared_ptr&lt;SubscriptionT> create_subscription( const std::string & topic_name, const rclcpp::QoS & qos, CallbackT && callback, const SubscriptionOptionsWithAllocator&lt;AllocatorT> & options = SubscriptionOptionsWithAllocator&lt;AllocatorT>(), typename MessageMemoryStrategyT::SharedPtr msg_mem_strat = ( MessageMemoryStrategyT::create_default() ) ); // åˆ›å»ºserviceçš„å®¢æˆ·ç«¯ template&lt;typename ServiceT> typename rclcpp::Client&lt;ServiceT>::SharedPtr create_client( const std::string & service_name, const rclcpp::QoS & qos = rclcpp::ServicesQoS(), rclcpp::CallbackGroup::SharedPtr group = nullptr); // åˆ›å»ºserviceçš„æœåŠ¡ç«¯ template&lt;typename ServiceT, typename CallbackT> typename rclcpp::Service&lt;ServiceT>::SharedPtr create_service( const std::string & service_name, CallbackT && callback, const rclcpp::QoS & qos = rclcpp::ServicesQoS(), rclcpp::CallbackGroup::SharedPtr group = nullptr); // å‚æ•°ç›¸å…³æ“ä½œæ–¹æ³• // å…¶ä»–æœåŠ¡æ–¹æ³• protected: Node( const Node & other, const std::string & sub_namespace); private: rclcpp::node_interfaces::NodeBaseInterface::SharedPtr node_base_; rclcpp::node_interfaces::NodeGraphInterface::SharedPtr node_graph_; rclcpp::node_interfaces::NodeLoggingInterface::SharedPtr node_logging_; rclcpp::node_interfaces::NodeTimersInterface::SharedPtr node_timers_; rclcpp::node_interfaces::NodeTopicsInterface::SharedPtr node_topics_; rclcpp::node_interfaces::NodeServicesInterface::SharedPtr node_services_; rclcpp::node_interfaces::NodeClockInterface::SharedPtr node_clock_; rclcpp::node_interfaces::NodeParametersInterface::SharedPtr node_parameters_; rclcpp::node_interfaces::NodeTimeSourceInterface::SharedPtr node_time_source_; rclcpp::node_interfaces::NodeTypeDescriptionsInterface::SharedPtr node_type_descriptions_; rclcpp::node_interfaces::NodeWaitablesInterface::SharedPtr node_waitables_; const rclcpp::NodeOptions node_options_; const std::string sub_namespace_; const std::string effective_namespace_; class NodeImpl; // This member is meant to be a place to backport features into stable distributions, // and new features targeting Rolling should not use this. // See the comment in node.cpp for more information. std::shared_ptr&lt;NodeImpl> hidden_impl_{nullptr}; }; 2ã€å¯åŠ¨ ä¸Šé¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œmainå‡½æ•°è°ƒç”¨äº†ä¸‰ä¸ªROS2 C++å®¢æˆ·ç«¯åº“çš„å‡½æ•°ï¼š
...</p></div><footer class=entry-footer><span title='2025-05-07 10:20:33 +0800 +0800'>2025-05-07</span>&nbsp;Â·&nbsp;Jerry Wang</footer><a class=entry-link aria-label="post link to ROS2æ¶æ„å’Œå®ç°" href=https://solaim.github.io/posts/ros2%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>è¯´è¯´k8sç½‘ç»œ</h2></header><div class=entry-content><p>1ã€k8sç»„ä»¶ k8sçš„ç»„ä»¶åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼šæ§åˆ¶å¹³é¢ç»„ä»¶å’ŒèŠ‚ç‚¹ç»„ä»¶ã€‚
æ§åˆ¶å¹³é¢ç»„ä»¶åŒ…æ‹¬ï¼š
kube-apiserverï¼šAPI serverï¼Œå¯ä»¥æ°´å¹³æ‰©å±•ã€‚ etcdï¼šåç«¯å­˜å‚¨ã€‚ kube-schedulerï¼šå†³ç­–æ–°åˆ›å»ºçš„Podåœ¨å“ªä¸ªNodeä¸Šè¿è¡Œã€‚ kube-controller-managerï¼šcontrollerè¿›ç¨‹ï¼Œè§‚æµ‹Objectçš„çŠ¶æ€ï¼Œcurrent state -> desired stateã€‚ èŠ‚ç‚¹ç»„ä»¶åŒ…æ‹¬ï¼š
kubeletï¼šè¿è¡ŒPodã€‚ kube-proxyï¼šç½‘ç»œä»£ç†ï¼Œ k8sä¸­Serviceçš„éƒ¨åˆ†å®ç°ï¼Œè´Ÿè´£ç»´æŠ¤èŠ‚ç‚¹ä¸Šçš„ç½‘ç»œè§„åˆ™ã€‚ Container runtimeï¼šDockerã€containerdã€CRI-Oã€‚ 2ã€k8sç½‘ç»œéœ€è¦è§£å†³çš„é—®é¢˜ k8så¯¹ä»»ä½•CNIå®ç°æœ‰å¦‚ä¸‹è§„å®šï¼š
Podä¸Podä¹‹é—´çš„é€šä¿¡æ— é¡»ä½¿ç”¨NAT èŠ‚ç‚¹ä¸Podä¹‹é—´çš„é€šä¿¡æ— é¡»ä½¿ç”¨NAT Podä¸å…¶ä»–Podçœ‹åˆ°è‡ªèº«çš„IPç›¸åŒ k8sä¸­çš„Serviceè´Ÿè´£å¯¹å†…ã€å¯¹å¤–æš´éœ²ç½‘ç»œè®¿é—®ï¼Œæƒ³è®©åº”ç”¨èƒ½å¤Ÿåœ¨é›†ç¾¤å†…å¤–æ­£å¸¸è®¿é—®ï¼Œéœ€è¦è§£å†³ä¸‹é¢çš„å‡ ä¸ªé—®é¢˜ï¼š
å®¹å™¨ä¸å®¹å™¨çš„é€šä¿¡ Podä¸Podçš„é€šä¿¡ Podä¸Serviceçš„é€šä¿¡ Internetä¸Serviceçš„é€šä¿¡ 3ã€å®¹å™¨ä¸å®¹å™¨çš„é€šä¿¡ åœ¨Linuxä¸­ï¼Œä½¿ç”¨Namespaceæœºåˆ¶å®ç°å†…æ ¸çº§åˆ«èµ„æºçš„éš”ç¦»ï¼Œç›®å‰æä¾›å…­ç§Namespaceï¼š
Mount: éš”ç¦»æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹ UTS: éš”ç¦»ä¸»æœºåå’ŒåŸŸåä¿¡æ¯ IPC: éš”ç¦»è¿›ç¨‹é—´é€šä¿¡ PID: éš”ç¦»è¿›ç¨‹çš„ID Network: éš”ç¦»ç½‘ç»œèµ„æº User: éš”ç¦»ç”¨æˆ·å’Œç”¨æˆ·ç»„çš„ID ç½‘ç»œå‘½åç©ºé—´netnså­˜åœ¨ä¸€ä¸ªroot network namespaceï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒLinuxå°†æ¯ä¸ªè¿›ç¨‹çš„netnsè®¾ç½®ä¸ºrootï¼Œä»¥æä¾›ç½‘ç»œè®¿é—®ã€‚
å¯¹äºDockerï¼ŒPodä½¿ç”¨åŒä¸€ä¸ªç½‘ç»œå‘½åç©ºé—´ï¼ŒPodä¹‹é—´é€šè¿‡Namespaceéš”ç¦»ï¼ŒPodå†…çš„å®¹å™¨å…±äº«ç½‘ç»œå‘½åç©ºé—´ï¼ŒDockerè´Ÿè´£åˆ›å»ºç½‘ç»œå‘½åç©ºé—´ï¼Œåº”ç”¨å®¹å™¨ä½¿ç”¨-networkåŠ å…¥è¯¥ç½‘ç»œå‘½åç©ºé—´ï¼Œå®¹å™¨ä¹‹é—´é€šè¿‡localhosté€šä¿¡ã€‚
4ã€Podä¸Podçš„é€šä¿¡ k8sä¸­ï¼Œæ¯ä¸ªPodæ‹¥æœ‰ä¸€ä¸ªçœŸå®çš„IPï¼ŒPodä¹‹é—´é€šè¿‡IPé€šä¿¡ã€‚
ï¼ˆæœ¬èŠ‚å›¾ç‰‡æ¥æºï¼šKevin Sookocheff Blogï¼‰
5ã€Podä¸Serviceçš„é€šä¿¡ Podéšç€æ—¶é—´ï¼Œå¯èƒ½æ¶ˆå¤±ã€é‡å¯ï¼Œé‚£ä¹ˆç›´æ¥ä½¿ç”¨Pod IPè¿›è¡Œè®¿é—®ï¼Œåœ¨åŠ¨æ€å˜åŒ–çš„ç¯å¢ƒä¸­ä¼šå­˜åœ¨ç½‘ç»œé—®é¢˜ã€‚k8sä¸­ä½¿ç”¨Serviceè§£å†³è¿™ä¸ªé—®é¢˜ã€‚ï¼ˆæœ¬èŠ‚å›¾ç‰‡æ¥æºï¼šKevin Sookocheff Blogï¼‰
åˆ›å»ºä¸€ä¸ªæ–°çš„Service Objectï¼Œå®é™…ä¸Šæ˜¯åˆ›å»ºäº†ä¸€ä¸ªè™šæ‹ŸIPå’Œä¸€ç³»åˆ—ç½‘ç»œè§„åˆ™ã€‚
kube-proxyè´Ÿè´£ç»´æŠ¤ã€æ›´æ–°ã€åˆ é™¤ã€æ·»åŠ ç½‘ç»œè§„åˆ™ï¼Œå…¶æ”¯æŒçš„ä»£ç†æ¨¡å¼æœ‰ï¼š
userspace iptablesï¼ˆé»˜è®¤ï¼‰ ipvs kernelspace (windows) ...</p></div><footer class=entry-footer><span title='2021-06-06 11:17:45 +0800 +0800'>2021-06-06</span>&nbsp;Â·&nbsp;Jerry Wang</footer><a class=entry-link aria-label="post link to è¯´è¯´k8sç½‘ç»œ" href=https://solaim.github.io/posts/%E8%AF%B4%E8%AF%B4k8s%E7%BD%91%E7%BB%9C/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Prometheuså†…éƒ¨å®ç°(å››)</h2></header><div class=entry-content><p>ç›®æ ‡è¯¥æ€ä¹ˆç®¡ç†ï¼Ÿé™æ€è¿˜æ˜¯åŠ¨æ€å‘ç°ï¼Ÿ
ç›®æ ‡ç®¡ç†æ˜¯ä½¿ç”¨é™æ€è¿˜æ˜¯åŠ¨æ€å‘ç°ï¼Œè¿™ä¸ªå’ŒåŸºç¡€æ¶æ„æœ‰å…³ï¼Œè¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦å…ˆè¯´è¯´åº”ç”¨éƒ¨ç½²çš„ç°çŠ¶ï¼
ç›®å‰ï¼Œä¼ä¸šåº”ç”¨éƒ¨ç½²æœ‰ä¸¤ç§é€‰é¡¹ï¼š
åŸºäºè™šæ‹Ÿæœº åŸºäºå®¹å™¨ å½“ç„¶ï¼Œæ›´å¤šçš„æ˜¯è™šæ‹Ÿæœºé‡Œè£…dockerï¼Œç®—æ˜¯ä¸¤è€…çš„ç»“åˆï¼ŒèŠ‚çœæˆæœ¬ã€‚
é‚£ä¹ˆåŸºäºè™šæ‹Ÿæœºéƒ¨ç½²åº”ç”¨æœ‰ä»€ä¹ˆç‰¹ç‚¹å‘¢ï¼Ÿå°±æ˜¯å˜åŒ–å°ï¼Œä½ çš„é¢„æœŸå’Œå®é™…æƒ…å†µæ˜¯ç›¸å¯¹é™æ­¢çš„ï¼Œåœ¨è™šæ‹Ÿæœºä¸Šéƒ¨ç½²ä¸€å¥—åº”ç”¨ï¼Œä¸€å¥—æµç¨‹èµ°ä¸‹æ¥ï¼Œå¤§æ¦‚å¾—å°åŠå¤©å§ï¼Œè¿™ç§æƒ…å†µæŠŠè¦ç›‘æ§çš„ç›®æ ‡å†™åˆ°Prometheusçš„é…ç½®æ–‡ä»¶ï¼Œå†é‡å¯Prometheus serverï¼Œå®Œå…¨ç©å¾—è½¬ï¼
ç„¶è€Œï¼Œå½“å…¬å¸çš„åº”ç”¨å¼€å§‹åŸºäºå®¹å™¨éƒ¨ç½²ï¼Œç‰¹åˆ«æ˜¯ç®¡æ§å¹³é¢ä½¿ç”¨äº†k8sï¼Œé‚£ä¹ˆæ‰‹åŠ¨é…ç½®Prometheusã€é‡å¯å°±æˆä¸ºäº†å™©æ¢¦ä¸€æ ·çš„å­˜åœ¨ï¼è¿ç»´ä¼šç–²äºå¥”å‘½ï¼Œå¼€å‘ä¼šåæ§½è¿ç»´ã€‚
æ‰€ä»¥ç›‘æ§ç›®æ ‡çš„é…ç½®ï¼Œå–å†³äºä½¿ç”¨çš„åº•å±‚æŠ€æœ¯ï¼
é¢˜å¤–è¯ï¼šè¦æƒ³Devopsåœ¨ä¼ä¸šè½åœ°ï¼Œå¾—æœ‰ä¸€æ•´å¥—é…å¥—çš„å·¥å…·ï¼Œæ•´ä½“æ‰“é€šã€‚
é‚£ä¹ˆPrometheusåœ¨æŠ“å–ç›®æ ‡æ–¹é¢æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿæˆ‘ä»¬å…ˆé‡æ¸©ä¸€ä¸‹ç›¸å…³ç»„ä»¶çš„å¯åŠ¨ï¼š
{ // Scrape discovery manager. g.Add( func() error { err := discoveryManagerScrape.Run() level.Info(logger).Log("msg", "Scrape discovery manager stopped") return err }, func(err error) { level.Info(logger).Log("msg", "Stopping scrape discovery manager...") cancelScrape() }, ) } { // Notify discovery manager. ... } { // Scrape manager. g.Add( func() error { // When the scrape manager receives a new targets list // it needs to read a valid config for each job. // It depends on the config being in sync with the discovery manager so // we wait until the config is fully loaded. &lt;-reloadReady.C err := scrapeManager.Run(discoveryManagerScrape.SyncCh()) level.Info(logger).Log("msg", "Scrape manager stopped") return err }, func(err error) { // Scrape manager needs to be stopped before closing the local TSDB // so that it doesn't try to write samples to a closed storage. level.Info(logger).Log("msg", "Stopping scrape manager...") scrapeManager.Stop() }, ) } å¯åŠ¨çš„æ ¸å¿ƒè¯­å¥ï¼š
...</p></div><footer class=entry-footer><span title='2021-03-22 21:31:03 +0800 +0800'>2021-03-22</span>&nbsp;Â·&nbsp;Jerry Wang</footer><a class=entry-link aria-label="post link to Prometheuså†…éƒ¨å®ç°(å››)" href=https://solaim.github.io/posts/prometheus%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0%E5%9B%9B/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Prometheuså†…éƒ¨å®ç°(ä¸‰)</h2></header><div class=entry-content><p>éçº¿æ€§ => çº¿æ€§ï¼Œæ··ä¹± => ç§©åº
ä¸Šä¸€ç¯‡åšæ–‡ä¸»è¦å†™äº†Prometheus serverçš„å¯åŠ¨è¿‡ç¨‹ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ·±å…¥å„ä¸ªç»„ä»¶ï¼Œäº†è§£å…¶å…·ä½“å®ç°ï¼Œè¿™ç¯‡æ–‡ä»¶ä¸»è¦ä»‹ç»Initial configuration loadingéƒ¨åˆ†ã€‚
Prometheus serverçš„mainå‡½æ•°æœ‰ä¸¤ä¸ªå¾ˆç²¾å½©çš„å®ç°ï¼Œä¸€ä¸ªæ˜¯reloaderçš„æ³¨å†Œï¼Œä¸€ä¸ªæ˜¯ç»„ä»¶å¯åŠ¨ã€‚ä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œæ‰€æœ‰çš„ç»„ä»¶éƒ½æ˜¯åŒæ—¶å¯åŠ¨çš„å—ï¼Ÿè¿˜æ˜¯æœ‰ä»€ä¹ˆé¡ºåºï¼Ÿ
æˆ‘ä»¬åˆ—ä¸€ä¸ªç»„ä»¶æ¸…å•ï¼š
- Termination handler. - Scrape discovery manager. - Notify discovery manager. - Scrape manager. - Reload handler. - Rule manager. - TSDB. - Web handler. - Notifier. å†æ¥çœ‹ä¸€ä¸‹ç»„ä»¶å¯åŠ¨ä½¿ç”¨çš„åº•å±‚æŠ€æœ¯:
run.Group is a universal mechanism to manage goroutine lifecycles.
Create a zero-value run.Group, and then add actors to it. Actors are defined as a pair of functions: an execute function, which should run synchronously; and an interrupt function, which, when invoked, should cause the execute function to return. Finally, invoke Run, which concurrently runs all of the actors, waits until the first actor exits, invokes the interrupt functions, and finally returns control to the caller only once all actors have returned. This general-purpose API allows callers to model pretty much any runnable task, and achieve well-defined lifecycle semantics for the group.
...</p></div><footer class=entry-footer><span title='2021-03-20 21:29:33 +0800 +0800'>2021-03-20</span>&nbsp;Â·&nbsp;Jerry Wang</footer><a class=entry-link aria-label="post link to Prometheuså†…éƒ¨å®ç°(ä¸‰)" href=https://solaim.github.io/posts/prometheus%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0%E4%B8%89/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Prometheuså†…éƒ¨å®ç°(äºŒ)</h2></header><div class=entry-content><p>è§‚å¯Ÿäº‹ç‰©ï¼Œéœ€è¦æçº²æŒˆé¢†ï¼è½¯ä»¶çš„å¯åŠ¨æ˜¯è§‚å¯Ÿè½¯ä»¶æœ€å¥½çš„å…¥å£ï¼
Prometheus serverå®ç°å…¥å£æ–‡ä»¶åœ¨cmd/prometheus/main.goã€‚
Prometheusçš„é…ç½®ç”±ä¸¤ä¸ªéƒ¨åˆ†æ„æˆï¼š
é…ç½®æ–‡ä»¶ï¼šprometheus.yml å¯åŠ¨flagï¼šå¯åŠ¨æ—¶æŒ‡å®š å…¥å£å‡½æ•°å¦‚ä¸‹ï¼š
func main() { ... } åˆå§‹åŒ–ä¸€ä¸ªflagConfigï¼Œè¿™ä¸ªé…ç½®è´¯ç©¿äº†æ•´ä¸ªç¨‹åº
cfg := flagConfig{ notifier: notifier.Options{ Registerer: prometheus.DefaultRegisterer, }, web: web.Options{ Registerer: prometheus.DefaultRegisterer, Gatherer: prometheus.DefaultGatherer, }, promlogConfig: promlog.Config{}, } ä½¿ç”¨kingpinæ³¨å†Œflag
a := kingpin.New(filepath.Base(os.Args[0]), "The Prometheus monitoring server").UsageWriter(os.Stdout) a.Version(version.Print("prometheus")) a.HelpFlag.Short('h') a.Flag("config.file", "Prometheus configuration file path."). Default("prometheus.yml").StringVar(&amp;cfg.configFile) a.Flag("web.listen-address", "Address to listen on for UI, API, and telemetry."). Default("0.0.0.0:9090").StringVar(&amp;cfg.web.ListenAddress) ... _, err := a.Parse(os.Args[1:]) if err != nil { fmt.Fprintln(os.Stderr, errors.Wrapf(err, "Error parsing commandline arguments")) a.Usage(os.Args[1:]) os.Exit(2) } åŠ è½½é…ç½®æ–‡ä»¶ï¼Œæ£€æŸ¥é…ç½®åˆæ³•æ€§
if _, err := config.LoadFile(cfg.configFile); err != nil { level.Error(logger).Log("msg", fmt.Sprintf("Error loading config (--config.file=%s)", cfg.configFile), "err", err) os.Exit(2) } åˆå§‹åŒ–å„ç§ç»„ä»¶
var ( localStorage = &amp;readyStorage{} scraper = &amp;readyScrapeManager{} remoteStorage = remote.NewStorage(log.With(logger, "component", "remote"), prometheus.DefaultRegisterer, localStorage.StartTime, cfg.localStoragePath, time.Duration(cfg.RemoteFlushDeadline), scraper) fanoutStorage = storage.NewFanout(logger, localStorage, remoteStorage) ) var ( ctxWeb, cancelWeb = context.WithCancel(context.Background()) ctxRule = context.Background() notifierManager = notifier.NewManager(&amp;cfg.notifier, log.With(logger, "component", "notifier")) ctxScrape, cancelScrape = context.WithCancel(context.Background()) discoveryManagerScrape = discovery.NewManager(ctxScrape, log.With(logger, "component", "discovery manager scrape"), discovery.Name("scrape")) ctxNotify, cancelNotify = context.WithCancel(context.Background()) discoveryManagerNotify = discovery.NewManager(ctxNotify, log.With(logger, "component", "discovery manager notify"), discovery.Name("notify")) scrapeManager = scrape.NewManager(log.With(logger, "component", "scrape manager"), fanoutStorage) opts = promql.EngineOpts{ Logger: log.With(logger, "component", "query engine"), Reg: prometheus.DefaultRegisterer, MaxSamples: cfg.queryMaxSamples, Timeout: time.Duration(cfg.queryTimeout), ActiveQueryTracker: promql.NewActiveQueryTracker(cfg.localStoragePath, cfg.queryConcurrency, log.With(logger, "component", "activeQueryTracker")), LookbackDelta: time.Duration(cfg.lookbackDelta), NoStepSubqueryIntervalFn: noStepSubqueryInterval.Get, EnableAtModifier: cfg.enablePromQLAtModifier, EnableNegativeOffset: cfg.enablePromQLNegativeOffset, } queryEngine = promql.NewEngine(opts) ruleManager = rules.NewManager(&amp;rules.ManagerOptions{ Appendable: fanoutStorage, Queryable: localStorage, QueryFunc: rules.EngineQueryFunc(queryEngine, fanoutStorage), NotifyFunc: sendAlerts(notifierManager, cfg.web.ExternalURL.String()), Context: ctxRule, ExternalURL: cfg.web.ExternalURL, Registerer: prometheus.DefaultRegisterer, Logger: log.With(logger, "component", "rule manager"), OutageTolerance: time.Duration(cfg.outageTolerance), ForGracePeriod: time.Duration(cfg.forGracePeriod), ResendDelay: time.Duration(cfg.resendDelay), }) ) scraper.Set(scrapeManager) å°†é…ç½®æ›´æ–°åˆ°flagConfig
...</p></div><footer class=entry-footer><span title='2021-03-15 21:28:09 +0800 +0800'>2021-03-15</span>&nbsp;Â·&nbsp;Jerry Wang</footer><a class=entry-link aria-label="post link to Prometheuså†…éƒ¨å®ç°(äºŒ)" href=https://solaim.github.io/posts/prometheus%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0%E4%BA%8C/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Prometheuså†…éƒ¨å®ç°(ä¸€)</h2></header><div class=entry-content><p>Prometheusåœ¨ç›‘æ§ç•Œä¸ºä»€ä¹ˆè¿™ä¹ˆğŸ”¥ï¼Ÿ
Prometheuså…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ
äººå¦‚å…¶åï¼Œäº§å“äº¦æ˜¯ï¼Prometheuså°±æ˜¯ç«ç§ï¼Œç…§è€€åœ¨å½“å‰çš„ç›‘æ§ä¸–ç•Œï¼
Prometheusè¿™æŠŠç«ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œç«åœ¨ä¸‰ä¸ªæ–¹é¢ï¼š
ç³»å‡ºåé—¨ï¼šCNCFçš„ç¬¬äºŒä¸ªé¡¹ç›®ï¼ŒCNCFçš„è€å¤§å«K8Sï¼Œè€å¤§å¯¹è€äºŒå¾ˆç…§é¡¾ï¼Œç›‘æ§é¦–é€‰ã€‚ é—¨åº­è‹¥å¸‚ï¼šå¼€æºï¼Œå¤§å‚ç«ç›¸äº‰ç”¨ã€‚ ç®€å•æ˜“ç”¨ï¼šæ¶æ„ç®€å•ï¼Œé…ç½®ç®€å•ï¼Œä¸Šä¸‹æ¸¸æ‰“é€šã€‚ å¤§å®¶éƒ½åœ¨ç”¨ï¼Œè€Œä¸”ç”¨èµ·æ¥å¾ˆæ–¹ä¾¿çš„ç¡®æ˜¯æˆ‘ä»¬é€‰æ‹©äº§å“çš„æ–¹æ³•ï¼Œä½†æ˜¯ä½œä¸ºå¼€å‘äººå‘˜ï¼Œè¿˜æ˜¯éœ€è¦äº†è§£ä¸€ä¸‹å…¶å†…éƒ¨çš„å®ç°ã€‚è¿™ä¸ªç³»åˆ—ï¼Œä¸»è¦æ ¹æ®Prometheusçš„ä»£ç å’Œæ–‡æ¡£ï¼Œæ¢³ç†Prometheusçš„å†…éƒ¨å®ç°ã€‚
æ€»ä½“æ¶æ„ Prometheusä»é…ç½®çš„jobsä¸­æŠ“å–metricsï¼Œå­˜å‚¨åœ¨æœ¬åœ°å­˜å‚¨æˆ–è€…å¤–éƒ¨å­˜å‚¨ä¸­ï¼Œåœ¨metricsä¸Šè¿è¡Œè§„åˆ™èšåˆå¤šç»´åº¦çš„æ•°æ®æˆ–è€…ç”Ÿæˆå‘Šè­¦ã€‚Grafanaæˆ–è€…è‡ªå¸¦çš„web UIèƒ½å¤Ÿæ–¹ä¾¿çš„å±•ç¤ºæ•°æ®ã€‚
Prometheusçš„ç»„ä»¶åŒ…æ‹¬ï¼š
serverï¼šè´Ÿè´£æŠ“å–metricsï¼Œå­˜å‚¨metricsï¼Œåˆ†æã€èšåˆmetrics client libraryï¼šå¤šç§è¯­è¨€çš„å®¢æˆ·ç«¯åº“ï¼Œæ–¹ä¾¿å®ç° push gatewayï¼šçŸ­æœŸå­˜æ´»æœåŠ¡metricsæ¨é€ç½‘å…³ exportersï¼šæ¯”å¦‚ç›‘æ§èŠ‚ç‚¹çš„node_exporterï¼Œç›‘æ§MySQLçš„mysqld_expoterç­‰ç­‰ alertmanagerï¼šalertmanagerè´Ÿè´£å‘Šè­¦çš„å‘é€ ä»æ€»ä½“æ¶æ„ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£å„ç§ç»„ä»¶ï¼Œä»¥åŠæ•°æ®çš„æµå‘ï¼Œç°åœ¨æˆ‘ä»¬å¼€å§‹ç ”ç©¶Prometheus serverçš„å†…éƒ¨å®ç°ã€‚
Serverå®ç°æ¶æ„ serverå¯åŠ¨çš„æ—¶å€™ï¼Œæ ¹æ®é…ç½®æ–‡ä»¶prometheus.ymlå’Œflagå†³å®šå„ç§é…ç½®ï¼Œé…ç½®æ–‡ä»¶åŒ…æ‹¬å…¨å±€é…ç½®ã€æŠ“å–ç›®æ ‡é…ç½®å’Œè§„åˆ™é…ç½®ç­‰ç­‰ã€‚scrape_configsé…ç½®äº†æŠ“å–çš„ç›®æ ‡ï¼ŒPrometheusæ”¯æŒåŠ¨æ€è·å–ç›®æ ‡ï¼ŒService discoveryè¯»å–é™æ€é…ç½®çš„ç›®æ ‡æˆ–è€…å‘¨æœŸæ›´æ–°åŠ¨æ€ç›®æ ‡ï¼Œæ·»åŠ åˆ°scrape managerï¼Œscrape managerè´Ÿè´£æŠ“å–ç›®æ ‡ï¼ŒæŠ“å–å®é™…æ˜¯ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œå³å„ç§exporterså®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªç®€å•çš„HTTPæœåŠ¡ï¼Œè´Ÿè´£æš´éœ²å„ç§åº”ç”¨çš„æŒ‡æ ‡ã€‚scrape manageræŠ“å–æŒ‡æ ‡åï¼Œå°†æ•°æ®äº¤ç»™fanout storageï¼Œfanout storageè´Ÿè´£æ•°æ®å­˜å‚¨ï¼Œæ”¯æŒæœ¬åœ°å­˜å‚¨å’Œå¤–éƒ¨å­˜å‚¨ã€‚rule manageræ ¹æ®è§„åˆ™ï¼ŒèšåˆæŒ‡æ ‡å­˜å‚¨åˆ°fanout storageï¼Œæˆ–è€…ç”Ÿæˆå‘Šè­¦å‘é€ç»™alert managerã€‚Prometheusä¹Ÿå®ç°äº†å„ç§webæ¥å£ï¼Œä½¿ç”¨promQLè¿›è¡Œæ•°æ®çš„æŸ¥è¯¢ã€‚
serverçš„ç»„ä»¶åŒ…æ‹¬ï¼š
Termination handler. Scrape discovery manager. Notify discovery manager. Scrape manager. Reload handler. Rule manager. TSDB. Web handler. Notifier. äº†è§£äº†serverçš„åŸºæœ¬æ¶æ„ï¼Œä¸‹é¢å¼€å§‹ç ”ç©¶serverçš„é…ç½®ã€‚
Prometheus.yml global: scrape_interval: 15s evaluation_interval: 15s rule_files: # - "first.rules" # - "second.rules" scrape_configs: - job_name: prometheus static_configs: - targets: ['localhost:9090'] è¿™æ˜¯å®˜ç½‘æä¾›çš„ä¸€ä¸ªç®€å•çš„é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«äº†ä¸‰ä¸ªéƒ¨åˆ†ï¼šå…¨å±€é…ç½®ã€è§„åˆ™é…ç½®å’ŒæŠ“å–é…ç½®ã€‚globalåŒ…æ‹¬å…¨å±€çš„é…ç½®ï¼Œrule_filesé…ç½®è§„åˆ™æ–‡ä»¶ï¼Œè¿™é‡Œæ²¡æœ‰é…ç½®ï¼Œscrape_configsé…ç½®æŠ“å–ç›®æ ‡ã€‚æŠ“å–ç›®æ ‡æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼ŒåŒ…æ‹¬å¤šä¸ªjobï¼Œæ¯ä¸ªjobæœ‰ä¸€ä¸ªjob_nameï¼Œç›®æ ‡é…ç½®ä»¥åŠå…¶ä»–é…ç½®ï¼Œç›®æ ‡é…ç½®å› ä¸ºæ”¯æŒå¤šç§ç›®æ ‡æºï¼Œæ‰€ä»¥è¿™å—åœ¨ä»£ç ä¸­çš„å®ç°æ¯”è¾ƒå¤æ‚ã€‚
...</p></div><footer class=entry-footer><span title='2021-03-14 21:32:08 +0800 +0800'>2021-03-14</span>&nbsp;Â·&nbsp;Jerry Wang</footer><a class=entry-link aria-label="post link to Prometheuså†…éƒ¨å®ç°(ä¸€)" href=https://solaim.github.io/posts/prometheus%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0%E4%B8%80/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>K8s Yamlé…ç½®æ–‡ä»¶</h2></header><div class=entry-content><p>1ã€Redis Deploymentéƒ¨ç½²ç¤ºä¾‹yaml å…ˆæ¥çœ‹ä¸€ä¸ªéƒ¨ç½²yamlç¤ºä¾‹æ–‡ä»¶ï¼š
# application/guestbook/redis-master-deployment.yaml apiVersion: apps/v1 # for versions before 1.9.0 use apps/v1beta2 kind: Deployment metadata: name: redis-master labels: app: redis spec: selector: matchLabels: app: redis role: master tier: backend replicas: 1 template: metadata: labels: app: redis role: master tier: backend spec: containers: - name: master image: redis # or just image: redis resources: requests: cpu: 100m memory: 100Mi ports: - containerPort: 6379 é€šè¿‡æ‰§è¡Œå‘½ä»¤kubectl create -f redis-master-deployment.yamlï¼Œå¯ä»¥åˆ›å»º1ä¸ªRedis master Podã€‚å¦‚æœæˆ‘æƒ³é€šè¿‡yamlæ–‡ä»¶åˆ›å»º3ä¸ªPodï¼Œæ€ä¹ˆåŠï¼Ÿ
...</p></div><footer class=entry-footer><span title='2019-11-18 21:23:35 +0800 +0800'>2019-11-18</span>&nbsp;Â·&nbsp;Jerry Wang</footer><a class=entry-link aria-label="post link to K8s Yamlé…ç½®æ–‡ä»¶" href=https://solaim.github.io/posts/k8s-yaml%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/></a></article><footer class=page-footer><nav class=pagination><a class=next href=https://solaim.github.io/page/2/>Next&nbsp;&nbsp;Â»</a></nav></footer></main><footer class=footer><span>&copy; 2025 <a href=https://solaim.github.io/>Jerry Wang</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>