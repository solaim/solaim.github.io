<!DOCTYPE html>
<html lang="zh-CN">
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0,  viewport-fit=cover" name="viewport" />
    <meta name="description" content="Flask-SocketIOåŸºæœ¬ä½¿ç”¨" />
    <meta name="hexo-theme-A4" content="v1.7.1" />
    <link rel="alternate icon" type="image/webp" href="/img/favicon.webp">
    <title>Coronarium | Drill down</title>

    
        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
    
    
<link rel="stylesheet" href="/css/ui.css">
 
    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.2"></head>
    
    <body>
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    
<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">Coronarium</a> 
            <span class="description">ä¸“æ³¨ã€æ¢ç´¢ã€ç§¯ç´¯</span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">é¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">æ–‡ç« </a></li>
            
        
            
                <li><a href="/tags/">æ ‡ç­¾</a></li>
            
        
            
                <li><a href="/about/">å…³äº</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">

    
        <div class="post-main-title">
            Flask-SocketIOåŸºæœ¬ä½¿ç”¨
        </div>
      
    

    <div class="post-md">
        
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-%E5%AE%89%E8%A3%85"><span class="post-toc-text">1.å®‰è£…</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="post-toc-text">2.åˆå§‹åŒ–</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#3-%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF"><span class="post-toc-text">3.æ¥æ”¶æ¶ˆæ¯</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#4%E3%80%81%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF"><span class="post-toc-text">4ã€å‘é€æ¶ˆæ¯</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5%E3%80%81%E5%B9%BF%E6%92%AD"><span class="post-toc-text">5ã€å¹¿æ’­</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#6%E3%80%81Rooms"><span class="post-toc-text">6ã€Rooms</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#7%E3%80%81%E8%BF%9E%E6%8E%A5%E4%BA%8B%E4%BB%B6"><span class="post-toc-text">7ã€è¿æ¥äº‹ä»¶</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#8%E3%80%81%E5%9F%BA%E4%BA%8E%E7%B1%BB%E7%9A%84%E5%91%BD%E5%90%8D%E5%9F%9F"><span class="post-toc-text">8ã€åŸºäºç±»çš„å‘½ååŸŸ</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#9%E3%80%81%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="post-toc-text">9ã€é”™è¯¯å¤„ç†</span></a></li></ol>
        
        <p>Flask-SocketIOæ˜¯ä¸€ä¸ªç”¨äºå»ºç«‹WebSocketå…¨åŒå·¥é€šä¿¡çš„Flaskæ‰©å±•ã€‚å®¢æˆ·ç«¯åº”ç”¨å¯ä»¥ä½¿ç”¨ä»»ä¸€SocketIOå®˜æ–¹å®¢æˆ·ç«¯åº“å®ç°ï¼Œæˆ–å¯ä»¥å»ºç«‹æŒä¹…è¿æ¥çš„å…¼å®¹å®¢æˆ·ç«¯å®ç°ã€‚</p>
<h2 id="1-å®‰è£…"><a href="#1-å®‰è£…" class="headerlink" title="1.å®‰è£…"></a>1.å®‰è£…</h2><blockquote>
<p>pip install flask-socketio</p>
</blockquote>
<p> Flask-SocketIOæä¾›ä¸‰ç§å¼‚æ­¥æœåŠ¡æœºåˆ¶ï¼š</p>
<ul>
<li>eventletï¼šæ”¯æŒé•¿è½®è¯¢å’Œwebsocket</li>
<li>geventï¼šéœ€ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“</li>
<li>Werkzeugï¼šä»…æ”¯æŒé•¿è½®è¯¢</li>
</ul>
<h2 id="2-åˆå§‹åŒ–"><a href="#2-åˆå§‹åŒ–" class="headerlink" title="2.åˆå§‹åŒ–"></a>2.åˆå§‹åŒ–</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template</span><br><span class="line"><span class="keyword">from</span> flask_socketio <span class="keyword">import</span> SocketIO</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;secret!&#x27;</span></span><br><span class="line">socketio = SocketIO(app)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    socketio.run(app)</span><br></pre></td></tr></table></figure>

<p>åº”ç”¨å¿…é¡»ç»™å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªhtmlé¡µé¢åŠ è½½SocketIOåº“ï¼Œå¹¶ä¸”å»ºç«‹è¿æ¥ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">    <span class="keyword">var</span> socket = io.connect(<span class="string">&#x27;http://&#x27;</span> + <span class="built_in">document</span>.domain + <span class="string">&#x27;:&#x27;</span> + location.port);</span><br><span class="line">    socket.on(<span class="string">&#x27;connect&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        socket.emit(<span class="string">&#x27;my event&#x27;</span>, &#123;<span class="attr">data</span>: <span class="string">&#x27;I\&#x27;m connected!&#x27;</span>&#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-æ¥æ”¶æ¶ˆæ¯"><a href="#3-æ¥æ”¶æ¶ˆæ¯" class="headerlink" title="3.æ¥æ”¶æ¶ˆæ¯"></a>3.æ¥æ”¶æ¶ˆæ¯</h2><p>ä½¿ç”¨SocketIOæ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä»¥äº‹ä»¶çš„æ–¹å¼æ¥æ”¶æ¶ˆæ¯-äº‹ä»¶é©±åŠ¨ã€‚åœ¨å®¢æˆ·ç«¯ï¼Œjavascriptä½¿ç”¨å›è°ƒå‡½æ•°ã€‚åœ¨æœåŠ¡ç«¯ï¼ŒFlask-SocketIOéœ€è¦æ³¨å†Œäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç±»ä¼¼äºè·¯ç”±-è§†å›¾å‡½æ•°æœºåˆ¶ã€‚</p>
<p>ä¸‹é¢çš„ä¾‹å­åˆ›å»ºæœåŠ¡ç«¯æ— åäº‹ä»¶å¤„ç†å‡½æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@socketio.on(<span class="params"><span class="string">&#x27;message&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_message</span>(<span class="params">message</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;received message: &#x27;</span> + message)</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨å­—ç¬¦ä¸²æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨jsonæ ¼å¼çš„æ¶ˆæ¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@socketio.on(<span class="params"><span class="string">&#x27;json&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_json</span>(<span class="params">json</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;received json: &#x27;</span> + <span class="built_in">str</span>(json))</span><br></pre></td></tr></table></figure>

<p>æœ€çµæ´»çš„äº‹ä»¶ç±»å‹æ˜¯ä½¿ç”¨å®šåˆ¶äº‹ä»¶åç§°ã€‚è¿™äº›äº‹ä»¶çš„æ¶ˆæ¯æ•°æ®æ ¼å¼å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€å­—èŠ‚ã€æ•´æ•°æˆ–è€…jsonï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@socketio.on(<span class="params"><span class="string">&#x27;my event&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_my_custom_event</span>(<span class="params">json</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;received json: &#x27;</span> + <span class="built_in">str</span>(json))</span><br></pre></td></tr></table></figure>

<p>å®šåˆ¶çš„å‘½åäº‹ä»¶æ”¯æŒå¤šå‚æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@socketio.on(<span class="params"><span class="string">&#x27;my event&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_my_custom_event</span>(<span class="params">arg1, arg2, arg3</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;received args: &#x27;</span> + arg1 + arg2 + arg3)</span><br></pre></td></tr></table></figure>

<p>å‘½åäº‹ä»¶æ˜¯æœ€çµæ´»çš„ï¼Œå› ä¸ºå‘½åäº‹ä»¶æ¶ˆé™¤äº†åŒ…å«é™„åŠ å…ƒæ•°æ®ï¼ˆæè¿°æ¶ˆæ¯ç±»å‹ï¼‰çš„éœ€è¦ã€‚Flask-socketIOä¹Ÿæ”¯æŒSocketIOå‘½ååŸŸï¼ŒSocketIOå‘½ååŸŸå…è®¸å®¢æˆ·ç«¯å¤ç”¨socketï¼ˆå¤šä¸ªè¿æ¥å»ºç«‹åœ¨åŒä¸€ç‰©ç†socketï¼‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@socketio.on(<span class="params"><span class="string">&#x27;my event&#x27;</span>, namespace=<span class="string">&#x27;/test&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_my_custom_namespace_event</span>(<span class="params">json</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;received json: &#x27;</span> + <span class="built_in">str</span>(json))</span><br></pre></td></tr></table></figure>

<p>å½“SocketIOæ²¡æœ‰æ˜¾å¼æŒ‡å®šå‘½ååŸŸï¼Œå…¨å±€å‘½ååŸŸâ€˜ï¼â€™å°†ä¼šè¢«ä½¿ç”¨ã€‚</p>
<p>å½“è£…é¥°å™¨è¯­æ³•ä¸å¤ªåˆé€‚æ—¶ï¼Œon_eventæ–¹æ³•å¯è¢«ä½¿ç”¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_function_handler</span>(<span class="params">data</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">socketio.on_event(<span class="string">&#x27;my event&#x27;</span>, my_function_handler, namespace=<span class="string">&#x27;/test&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>å®¢æˆ·ç«¯å¯èƒ½è¯·æ±‚ä¸€ä¸ªæ‰¿è®¤çš„å›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°ç¡®è®¤æ¥æ”¶å‘é€çš„æ¶ˆæ¯ã€‚å¤„ç†å‡½æ•°çš„ä»»ä½•è¿”å›å€¼å°†ä¼šä½œä¸ºå‚æ•°é€’é€ç»™å®¢æˆ·ç«¯çš„å›è°ƒå‡½æ•°ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@socketio.on(&#x27;my event&#x27;)</span><br><span class="line"><span class="function">def <span class="title">handle_my_custom_event</span><span class="params">(json)</span>:</span></span><br><span class="line">    print(&#x27;received json: &#x27; + str(json))</span><br><span class="line">    return &#x27;one&#x27;, 2</span><br></pre></td></tr></table></figure>

<p>ä¸Šä¾‹ä¸­ï¼Œå®¢æˆ·ç«¯å›è°ƒå‡½æ•°å°†ä¼šè¢«ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼šâ€˜oneâ€™å’Œ2ã€‚</p>
<h2 id="4ã€å‘é€æ¶ˆæ¯"><a href="#4ã€å‘é€æ¶ˆæ¯" class="headerlink" title="4ã€å‘é€æ¶ˆæ¯"></a>4ã€å‘é€æ¶ˆæ¯</h2><p>Socket IOäº‹ä»¶å¤„ç†å‡½æ•°å¯ä»¥å‘é€å›å¤æ¶ˆæ¯è‡³è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæ–¹æ³•åŒ…æ‹¬send()å’Œemit()ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_socketio <span class="keyword">import</span> send, emit</span><br><span class="line"></span><br><span class="line"><span class="meta">@socketio.on(<span class="params"><span class="string">&#x27;message&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_message</span>(<span class="params">message</span>):</span></span><br><span class="line">    send(message)</span><br><span class="line"></span><br><span class="line"><span class="meta">@socketio.on(<span class="params"><span class="string">&#x27;json&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_json</span>(<span class="params">json</span>):</span></span><br><span class="line">    send(json, json=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@socketio.on(<span class="params"><span class="string">&#x27;my event&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_my_custom_event</span>(<span class="params">json</span>):</span></span><br><span class="line">    emit(<span class="string">&#x27;my response&#x27;</span>, json)</span><br></pre></td></tr></table></figure>

<p>å½“ä½¿ç”¨å‘½ååŸŸæ—¶ï¼Œsendå’Œemité»˜è®¤ä½¿ç”¨æ¥æ”¶æ¶ˆæ¯çš„å‘½ååŸŸã€‚ä¸åŒçš„å‘½ååŸŸå¯ä»¥é€šè¿‡namespaceå‚æ•°æŒ‡å®šã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@socketio.on(<span class="params"><span class="string">&#x27;message&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_message</span>(<span class="params">message</span>):</span></span><br><span class="line">    send(message, namespace=<span class="string">&#x27;/chat&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@socketio.on(<span class="params"><span class="string">&#x27;my event&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_my_custom_event</span>(<span class="params">json</span>):</span></span><br><span class="line">    emit(<span class="string">&#x27;my response&#x27;</span>, json, namespace=<span class="string">&#x27;/chat&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>å½“ä½¿ç”¨å¤šä¸ªå‚æ•°å›å¤ä¸€ä¸ªäº‹ä»¶æ—¶ï¼Œå‘é€ä¸€ä¸ªtupleï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@socketio.on(<span class="params"><span class="string">&#x27;my event&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_my_custom_event</span>(<span class="params">json</span>):</span></span><br><span class="line">    emit(<span class="string">&#x27;my response&#x27;</span>, (<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, json), namespace=<span class="string">&#x27;/chat&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>SocketIOæ”¯æŒå›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°ç”¨äºè¯å®å®¢æˆ·ç«¯æˆåŠŸæ¥æ”¶äº†æ¶ˆæ¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ack</span>():</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;message was received!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@socketio.on(<span class="params"><span class="string">&#x27;my event&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_my_custom_event</span>(<span class="params">json</span>):</span></span><br><span class="line">    emit(<span class="string">&#x27;my response&#x27;</span>, json, callback=ack)</span><br></pre></td></tr></table></figure>

<p>å½“ä½¿ç”¨å›è°ƒå‡½æ•°æ—¶ï¼Œjså®¢æˆ·ç«¯ä»æ¥æ”¶çš„æ¶ˆæ¯ä¸­è·å–å›è°ƒå‡½æ•°ï¼Œå®¢æˆ·ç«¯å›è°ƒå‡½æ•°å”¤èµ·ä¹‹åæœåŠ¡ç«¯çš„å›è°ƒå‡½æ•°ç›¸åº”åœ°è¢«å”¤èµ·ã€‚å¦‚æ­Œå®¢æˆ·ç«¯å›è°ƒå‡½æ•°å…·æœ‰å‚æ•°ï¼ŒæœåŠ¡ç«¯çš„å›è°ƒå‡½æ•°å…·æœ‰ç›¸åŒçš„å‚æ•°ã€‚</p>
<h2 id="5ã€å¹¿æ’­"><a href="#5ã€å¹¿æ’­" class="headerlink" title="5ã€å¹¿æ’­"></a>5ã€å¹¿æ’­</h2><p>Flask-SocketIOæ”¯æŒå¹¿æ’­ï¼Œåªéœ€åœ¨sendå’Œemitå‡½æ•°ä¸­æ·»åŠ å…³é”®å­—å‚æ•°broadcast=Trueï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@socketio.on(<span class="params"><span class="string">&#x27;my event&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_my_custom_event</span>(<span class="params">data</span>):</span></span><br><span class="line">    emit(<span class="string">&#x27;my response&#x27;</span>, data, broadcast=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>å¯¹äºæœåŠ¡ç«¯ä¸»åŠ¨å‘èµ·çš„å¹¿æ’­ï¼Œsocketio.send()å’Œsocketio.emit()æ–¹æ³•å¯ä»¥ç”¨æ¥å¹¿æ’­æ¶ˆæ¯è‡³æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_function</span>():</span></span><br><span class="line">    socketio.emit(<span class="string">&#x27;some event&#x27;</span>, &#123;<span class="string">&#x27;data&#x27;</span>: <span class="number">42</span>&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="6ã€Rooms"><a href="#6ã€Rooms" class="headerlink" title="6ã€Rooms"></a>6ã€Rooms</h2><p>Flask-SocketIOé€šè¿‡join_roomå’Œleave_roomå‡½æ•°æ”¯æŒroomæ¦‚å¿µã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_socketio <span class="keyword">import</span> join_room, leave_room</span><br><span class="line"></span><br><span class="line"><span class="meta">@socketio.on(<span class="params"><span class="string">&#x27;join&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_join</span>(<span class="params">data</span>):</span></span><br><span class="line">    username = data[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">    room = data[<span class="string">&#x27;room&#x27;</span>]</span><br><span class="line">    join_room(room)</span><br><span class="line">    send(username + <span class="string">&#x27; has entered the room.&#x27;</span>, room=room)</span><br><span class="line"></span><br><span class="line"><span class="meta">@socketio.on(<span class="params"><span class="string">&#x27;leave&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_leave</span>(<span class="params">data</span>):</span></span><br><span class="line">    username = data[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">    room = data[<span class="string">&#x27;room&#x27;</span>]</span><br><span class="line">    leave_room(room)</span><br><span class="line">    send(username + <span class="string">&#x27; has left the room.&#x27;</span>, room=room)</span><br></pre></td></tr></table></figure>

<p>sendå’Œemitå‡½æ•°æ¥æ”¶å…³é”®å­—å‚æ•°roomï¼Œå°†æ¶ˆæ¯å‘é€è‡³è¿æ¥å¯¹åº”roomçš„å®¢æˆ·ç«¯ã€‚</p>
<p>æ‰€æœ‰çš„å®¢æˆ·ç«¯è¿æ¥roomæ—¶ç”¨session IDå‘½åï¼Œå¯ä»¥ä½¿ç”¨request.sidè·å–ã€‚</p>
<h2 id="7ã€è¿æ¥äº‹ä»¶"><a href="#7ã€è¿æ¥äº‹ä»¶" class="headerlink" title="7ã€è¿æ¥äº‹ä»¶"></a>7ã€è¿æ¥äº‹ä»¶</h2><p>Flask-SocketIOä¹Ÿæ”¯æŒè¿æ¥å’Œè¿æ¥æ–­å¼€äº‹ä»¶ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@socketio.on(<span class="params"><span class="string">&#x27;connect&#x27;</span>, namespace=<span class="string">&#x27;/chat&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_connect</span>():</span></span><br><span class="line">    emit(<span class="string">&#x27;my response&#x27;</span>, &#123;<span class="string">&#x27;data&#x27;</span>: <span class="string">&#x27;Connected&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@socketio.on(<span class="params"><span class="string">&#x27;disconnect&#x27;</span>, namespace=<span class="string">&#x27;/chat&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_disconnect</span>():</span></span><br><span class="line">    print(<span class="string">&#x27;Client disconnected&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="8ã€åŸºäºç±»çš„å‘½ååŸŸ"><a href="#8ã€åŸºäºç±»çš„å‘½ååŸŸ" class="headerlink" title="8ã€åŸºäºç±»çš„å‘½ååŸŸ"></a>8ã€åŸºäºç±»çš„å‘½ååŸŸ</h2><p>ä¸Šé¢æè¿°çš„æ˜¯åŸºäºè£…é¥°å™¨çš„å¤„ç†å‡½æ•°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŸºäºç±»çš„å‘½ååŸŸå¤„ç†å‡½æ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_socketio <span class="keyword">import</span> Namespace, emit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCustomNamespace</span>(<span class="params">Namespace</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">on_connect</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">on_disconnect</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">on_my_event</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        emit(<span class="string">&#x27;my_response&#x27;</span>, data)</span><br><span class="line"></span><br><span class="line">socketio.on_namespace(MyCustomNamespace(<span class="string">&#x27;/test&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h2 id="9ã€é”™è¯¯å¤„ç†"><a href="#9ã€é”™è¯¯å¤„ç†" class="headerlink" title="9ã€é”™è¯¯å¤„ç†"></a>9ã€é”™è¯¯å¤„ç†</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@socketio.on_error()        </span><span class="comment"># Handles the default namespace</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">error_handler</span>(<span class="params">e</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@socketio.on_error(<span class="params"><span class="string">&#x27;/chat&#x27;</span></span>) </span><span class="comment"># handles the &#x27;/chat&#x27; namespace</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">error_handler_chat</span>(<span class="params">e</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@socketio.on_error_default  </span><span class="comment"># handles all namespaces without an explicit error handler</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">default_error_handler</span>(<span class="params">e</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>


    </div>

    <div class="post-meta">
        <i>
        
            <span>2019-04-11</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« Bray Wang</span>
            
            
                <span>æ‰“ä¸Šæ ‡ç­¾:
                    
                    
                        <a href='/tags/Python-Flask-SocketIO/'>
                            Python, Flask, SocketIO
                        </a>
                    
                </span>
             
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='/categories/Python/'>
                            Python
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    
        

     
</div>



                    
                    
                    <div class="footer">
    
        <span> 
            Â© Bray Wang 

            
                

            
        </span>
    
</div>
<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>â˜€ï¸ç™½é©¹è¿‡éš™,æ—¶å…‰èè‹’ğŸŒ›</span>
            
                <span class="footer-last-span-right"><i>æœ¬ç«™ç”±<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/index.html">Hexo</a>é©±åŠ¨ï½œä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/HiNinoJay/hexo-theme-A4">Hexo-theme-A4</a>ä¸»é¢˜</i></span>
            
    
</div>


    
<link rel="stylesheet" href="/css/a11y-dark.min.css">

    
<script src="/js/highlight.min.js"></script>

    
<script src="/js/highlightjs-line-numbers.js"></script>



<script>
    hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
</script>
                </div>
            
    </body>
</html>