<!DOCTYPE html>
<html lang="zh-CN">
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0,  viewport-fit=cover" name="viewport" />
    <meta name="description" content="k8sé›†ç¾¤æ­å»º" />
    <meta name="hexo-theme-A4" content="v1.7.1" />
    <link rel="alternate icon" type="image/webp" href="/img/favicon.webp">
    <title>Coronarium | Drill down</title>

    
        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
    
    
<link rel="stylesheet" href="/css/ui.css">
 
    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.0.0-rc2"></head>
    
    <body>
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    
<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">Coronarium</a> 
            <span class="description">ä¸“æ³¨ã€æ¢ç´¢ã€ç§¯ç´¯</span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">é¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">æ–‡ç« </a></li>
            
        
            
                <li><a href="/about/">å…³äº</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">

    
        <div class="post-main-title">
            k8sé›†ç¾¤æ­å»º
        </div>
      
    

    <div class="post-md">
        
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1%E3%80%81%E8%8A%82%E7%82%B9"><span class="post-toc-text">1ã€èŠ‚ç‚¹</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2%E3%80%81docker%E5%AE%89%E8%A3%85"><span class="post-toc-text">2ã€dockerå®‰è£…</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#3%E3%80%81kubernetes%E5%AE%89%E8%A3%85"><span class="post-toc-text">3ã€kuberneteså®‰è£…</span></a></li></ol>
        
        <h2 id="1ã€èŠ‚ç‚¹"><a href="#1ã€èŠ‚ç‚¹" class="headerlink" title="1ã€èŠ‚ç‚¹"></a>1ã€èŠ‚ç‚¹</h2><table>
<thead>
<tr>
<th>èŠ‚ç‚¹</th>
<th>IP</th>
</tr>
</thead>
<tbody><tr>
<td>master</td>
<td>192.168.124.100</td>
</tr>
<tr>
<td>node1</td>
<td>192.168.124.101</td>
</tr>
<tr>
<td>node2</td>
<td>192.168.124.102</td>
</tr>
<tr>
<td>node3</td>
<td>192.168.124.103</td>
</tr>
</tbody></table>
<h2 id="2ã€dockerå®‰è£…"><a href="#2ã€dockerå®‰è£…" class="headerlink" title="2ã€dockerå®‰è£…"></a>2ã€dockerå®‰è£…</h2><p>å®‰è£…ä½¿ç”¨å®˜æ–¹æºï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½ä»“åº“</span></span><br><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d</span><br><span class="line">wget https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">yum makecache fast</span><br><span class="line"><span class="comment"># å®‰è£…docker</span></span><br><span class="line">yum install docker-ce docker-ce-cli containerd.io</span><br><span class="line"><span class="comment"># å¯åŠ¨docker</span></span><br><span class="line">systemctl <span class="built_in">enable</span> docker &amp;&amp; systemctl start docker</span><br></pre></td></tr></table></figure>

<h2 id="3ã€kuberneteså®‰è£…"><a href="#3ã€kuberneteså®‰è£…" class="headerlink" title="3ã€kuberneteså®‰è£…"></a>3ã€kuberneteså®‰è£…</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"># æ·»åŠ ä»“åº“</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF &gt; /etc/yum.repos.d/kubernetes.repo</span></span><br><span class="line"><span class="string">[kubernetes]</span></span><br><span class="line"><span class="string">name=Kubernetes</span></span><br><span class="line"><span class="string">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">repo_gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°yum cache</span></span><br><span class="line">yum makecache fast</span><br><span class="line"></span><br><span class="line"><span class="comment"># kubeadmåˆå§‹åŒ–ä¼šæŠ¥é”™, éœ€è¦æ‰§è¡Œä¸‹åˆ—å‘½ä»¤</span></span><br><span class="line"><span class="comment"># 1ã€å…³é—­firewalld</span></span><br><span class="line">systemctl diable firewalld &amp;&amp; systemctl stop firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2ã€å…³é—­selinux</span></span><br><span class="line">setenforce 0 &amp;&amp; sed -i <span class="string">&quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot;</span> /etc/selinux/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3ã€å…³é—­swap</span></span><br><span class="line">swapoff -a &amp;&amp; sed -i <span class="string">&#x27;/ swap / s/^/#/&#x27;</span> /etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4ã€è®¾ç½®ç½‘ç»œ</span></span><br><span class="line"><span class="built_in">touch</span> /etc/sysctl.d/k8s.conf</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/sysctl.d/k8s.conf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">modprobe br_netfilter &amp;&amp; sysctl -p /etc/sysctl.d/k8s.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># masterèŠ‚ç‚¹æ‰§è¡Œ</span></span><br><span class="line">yum install kubeadm kubectl kubelet</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰€æœ‰nodeèŠ‚ç‚¹æ‰§è¡Œ</span></span><br><span class="line">yum install kubeadm kubelet</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨å®é™…è¿è¡Œå®¹å™¨çš„æœåŠ¡kubelet</span></span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet &amp;&amp; systemctl start kubelet</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç°åœ¨æ‰§è¡Œkubeletä¼šæŠ¥é”™ï¼Œä¸ç”¨ç®¡</span></span><br><span class="line"><span class="comment"># kubeadm initæˆ–joinä¹‹åï¼Œsystemdä¼šè‡ªåŠ¨æ‹‰èµ·kubelet</span></span><br><span class="line"><span class="comment"># kubeadmæ˜¯é›†ç¾¤ç®¡ç†å·¥å…·</span></span><br><span class="line"><span class="comment"># kubeletè´Ÿè´£è¿è¡Œpods</span></span><br><span class="line"><span class="comment"># kubectlæ˜¯å®¢æˆ·ç«¯ï¼Œè´Ÿè´£å’Œkube-apiserveré€šä¿¡</span></span><br><span class="line"><span class="comment"># ç”¨ç±»æ¯”è§£é‡Šçš„è¯ï¼Œkubectlæ˜¯curlï¼Œkube-apiserveræ˜¯æœåŠ¡å™¨</span></span><br><span class="line"><span class="comment"># kube-controller-manageræ˜¯æ§åˆ¶å™¨</span></span><br><span class="line"><span class="comment"># kube-scheduleræ˜¯è°ƒåº¦å™¨</span></span><br><span class="line"><span class="comment"># kube-proxyè´Ÿè´£ç½‘ç»œé€šä¿¡</span></span><br><span class="line"><span class="comment"># pauseæ˜¯podç©ºé—²è¿è¡Œçš„é•œåƒ</span></span><br><span class="line"><span class="comment"># etcdç”¨äºåˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”±äºkubeadmä½¿ç”¨é•œåƒæ‹‰èµ·k8sï¼Œä½†æ˜¯è¢«å¢™äº†ï¼Œæ‰€ä»¥åœ¨å¯ä»¥ç¿»å¢™çš„ä¸»æœºä¸Šä¸‹è½½é•œåƒï¼Œç„¶åä½¿ç”¨ä¸‹åˆ—å‘½ä»¤å¯¼å‡ºé•œåƒ</span></span><br><span class="line"><span class="comment"># docker save -o package.tar.gz image1:latest</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨ä¸‹é¢å‘½ä»¤å¯¼å…¥é•œåƒ</span></span><br><span class="line"><span class="comment"># docker load -i package.tar.gz</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–éœ€è¦ä¸‹è½½çš„é•œåƒåˆ—è¡¨</span></span><br><span class="line">kubeadm config images list</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºå¦‚ä¸‹ï¼Œmasterè¡¨ç¤ºåœ¨ä¸»èŠ‚ç‚¹å®‰è£…ï¼Œnodeè¡¨ç¤ºåœ¨ä»èŠ‚ç‚¹å®‰è£…</span></span><br><span class="line">k8s.gcr.io/kube-apiserver:v1.16.1 <span class="comment"># master </span></span><br><span class="line">k8s.gcr.io/kube-controller-manager:v1.16.1 <span class="comment"># master </span></span><br><span class="line">k8s.gcr.io/kube-scheduler:v1.16.1 <span class="comment"># master </span></span><br><span class="line">k8s.gcr.io/kube-proxy:v1.16.1 <span class="comment"># master node </span></span><br><span class="line">k8s.gcr.io/pause:3.1 <span class="comment"># node </span></span><br><span class="line">k8s.gcr.io/etcd:3.3.15-0 <span class="comment"># master </span></span><br><span class="line">k8s.gcr.io/coredns:1.6.2 <span class="comment"># master node </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¾ˆä¸å¹¸ï¼Œè¢«å¢™äº†</span></span><br><span class="line"><span class="comment"># ç”¨å¯ä»¥ç¿»å¢™çš„ä¸»æœºç”¨docker pullæ‹‰å–é•œåƒï¼Œä¸Šä¼ æœ¬åœ°å³å¯</span></span><br><span class="line"><span class="comment"># é•œåƒçš„æ‰“åŒ…ä½¿ç”¨saveå‘½ä»¤</span></span><br><span class="line"><span class="comment"># é•œåƒçš„å¯¼å…¥ä½¿ç”¨loadå‘½ä»¤</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½å¥½é•œåƒï¼Œå¯¼å…¥å®Œæ¯•</span></span><br><span class="line"><span class="comment"># åœ¨masterèŠ‚ç‚¹æ‰§è¡Œ</span></span><br><span class="line">kubeadm init --kubernetes-version=v1.16.1 --apiserver-advertise-address=192.168.124.100 --pod-network-cidr=10.244.0.0/16</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰§è¡ŒæˆåŠŸåï¼Œä¼šæç¤ºè¿›è¡Œå¦‚ä¸‹æ“ä½œ</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">sudo <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">sudo <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># èŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ“ä½œ</span></span><br><span class="line">kubeadm <span class="built_in">join</span> 192.168.124.100:6443 --token ba04v7.y9ki5jgbss8gs0jx \</span><br><span class="line">  --discovery-token-ca-cert-hash sha256:8404de0f262daf02de05aad96415c79c2ff39b91ce3ee28cd8248426166123a9 </span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># k8sçš„ç½‘ç»œæ¨¡å‹æ˜¯æ‰å¹³åŒ–çš„ï¼Œå³podä¹‹é—´éœ€è¦èƒ½å¤Ÿç›´æ¥è®¿é—®ï¼Œåœ¨è°·æ­Œçš„å®ç°ä¸­ï¼Œå·²ç»æ”¯æŒæ‰å¹³åŒ–ç½‘ç»œæ¨¡å‹</span></span><br><span class="line"><span class="comment"># ä½†æ˜¯æˆ‘ä»¬åˆ›å»ºçš„é›†ç¾¤ï¼Œä¸æ»¡è¶³è¿™ç§ç½‘ç»œæ¨¡å‹ï¼Œæ‰€ä»¥éœ€è¦å€ŸåŠ©æ’ä»¶æˆ–è€…è¿›è¡Œä¸»æœºé…ç½®ä¹‹åæ‰èƒ½æ»¡è¶³</span></span><br><span class="line"><span class="comment"># åˆšå¼€å§‹å­¦ä¹ å»ºè®®ä½¿ç”¨flannelï¼Œå‡å°‘éšœç¢ï¼ŒåæœŸæœ‰éœ€è¦è¿›è¡Œè°ƒç ”å­¦ä¹ </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…flannel</span></span><br><span class="line">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨masteræ‰§è¡Œ</span></span><br><span class="line">kubectl get nodes</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºï¼Œæš‚æ—¶é…ç½®äº†ä¸¤ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">NAME     STATUS   ROLES    AGE   VERSION</span><br><span class="line">master   Ready    master   50m   v1.16.1</span><br><span class="line">node1    Ready    &lt;none&gt;   27m   v1.16.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ²¡æœ‰å®‰è£…flannelä¹‹å‰ï¼ŒæŸ¥çœ‹nodesï¼Œä¼šæç¤ºSTATUSä¸ºNotReadyã€‚</span></span><br><span class="line"><span class="comment"># è‡³æ­¤ï¼Œk8sçš„åŸºæœ¬å®‰è£…å°±ç»“æŸäº†ã€‚</span></span><br><span class="line"><span class="comment"># æ˜¯ä¸æ˜¯å¾ˆç®€å•</span></span><br><span class="line"><span class="comment"># åç»­ä¼šç»§ç»­åˆ†äº«k8sçš„å­¦ä¹ </span></span><br></pre></td></tr></table></figure>


    </div>

    <div class="post-meta">
        <i>
        
            <span>2019-10-15</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« Bray Wang</span>
            
            
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='/categories/k8s/'>
                            k8s
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    
        

     
</div>



                    
                    
                    <div class="footer">
    
        <span> 
            Â© Bray Wang 

            
                

            
        </span>
    
</div>
<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>â˜€ï¸ç™½é©¹è¿‡éš™,æ—¶å…‰èè‹’ğŸŒ›</span>
            
                <span class="footer-last-span-right"><i>æœ¬ç«™ç”±<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/index.html">Hexo</a>é©±åŠ¨ï½œä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/HiNinoJay/hexo-theme-A4">Hexo-theme-A4</a>ä¸»é¢˜</i></span>
            
    
</div>


    
<link rel="stylesheet" href="/css/a11y-dark.min.css">

    
<script src="/js/highlight.min.js"></script>

    
<script src="/js/highlightjs-line-numbers.js"></script>



<script>
    hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
</script>
                </div>
            
    </body>
</html>