<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Prometheus | Jerry Wang</title>
<meta name=keywords content><meta name=description content="Jerry Wang's Personal Blog"><meta name=author content="Jerry Wang"><link rel=canonical href=https://solaim.github.io/tags/prometheus/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://solaim.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://solaim.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://solaim.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://solaim.github.io/apple-touch-icon.png><link rel=mask-icon href=https://solaim.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://solaim.github.io/tags/prometheus/index.xml><link rel=alternate hreflang=en href=https://solaim.github.io/tags/prometheus/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://solaim.github.io/tags/prometheus/"><meta property="og:site_name" content="Jerry Wang"><meta property="og:title" content="Prometheus"><meta property="og:description" content="Jerry Wang's Personal Blog"><meta property="og:locale" content="en-us"><meta property="og:type" content="website"><meta property="og:image" content="https://solaim.github.io/img/favicon.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://solaim.github.io/img/favicon.webp"><meta name=twitter:title content="Prometheus"><meta name=twitter:description content="Jerry Wang's Personal Blog"></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://solaim.github.io/ accesskey=h title="é¦–é¡µ (Alt + H)"><img src=https://solaim.github.io/apple-touch-icon.png alt aria-label=logo height=35>é¦–é¡µ</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://solaim.github.io/categories/ title=ğŸ•¸åˆ†ç±»><span>ğŸ•¸åˆ†ç±»</span></a></li><li><a href=https://solaim.github.io/tags/ title=ğŸšæ ‡ç­¾><span>ğŸšæ ‡ç­¾</span></a></li><li><a href=https://solaim.github.io/about/ title=ğŸŒå…³äº><span>ğŸŒå…³äº</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://solaim.github.io/>Home</a>&nbsp;Â»&nbsp;<a href=https://solaim.github.io/tags/>Tags</a></div><h1>Prometheus
<a href=/tags/prometheus/index.xml title=RSS aria-label=RSS><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="23"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Prometheuså†…éƒ¨å®ç°(å››)</h2></header><div class=entry-content><p>ç›®æ ‡è¯¥æ€ä¹ˆç®¡ç†ï¼Ÿé™æ€è¿˜æ˜¯åŠ¨æ€å‘ç°ï¼Ÿ
ç›®æ ‡ç®¡ç†æ˜¯ä½¿ç”¨é™æ€è¿˜æ˜¯åŠ¨æ€å‘ç°ï¼Œè¿™ä¸ªå’ŒåŸºç¡€æ¶æ„æœ‰å…³ï¼Œè¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦å…ˆè¯´è¯´åº”ç”¨éƒ¨ç½²çš„ç°çŠ¶ï¼
ç›®å‰ï¼Œä¼ä¸šåº”ç”¨éƒ¨ç½²æœ‰ä¸¤ç§é€‰é¡¹ï¼š
åŸºäºè™šæ‹Ÿæœº åŸºäºå®¹å™¨ å½“ç„¶ï¼Œæ›´å¤šçš„æ˜¯è™šæ‹Ÿæœºé‡Œè£…dockerï¼Œç®—æ˜¯ä¸¤è€…çš„ç»“åˆï¼ŒèŠ‚çœæˆæœ¬ã€‚
é‚£ä¹ˆåŸºäºè™šæ‹Ÿæœºéƒ¨ç½²åº”ç”¨æœ‰ä»€ä¹ˆç‰¹ç‚¹å‘¢ï¼Ÿå°±æ˜¯å˜åŒ–å°ï¼Œä½ çš„é¢„æœŸå’Œå®é™…æƒ…å†µæ˜¯ç›¸å¯¹é™æ­¢çš„ï¼Œåœ¨è™šæ‹Ÿæœºä¸Šéƒ¨ç½²ä¸€å¥—åº”ç”¨ï¼Œä¸€å¥—æµç¨‹èµ°ä¸‹æ¥ï¼Œå¤§æ¦‚å¾—å°åŠå¤©å§ï¼Œè¿™ç§æƒ…å†µæŠŠè¦ç›‘æ§çš„ç›®æ ‡å†™åˆ°Prometheusçš„é…ç½®æ–‡ä»¶ï¼Œå†é‡å¯Prometheus serverï¼Œå®Œå…¨ç©å¾—è½¬ï¼
ç„¶è€Œï¼Œå½“å…¬å¸çš„åº”ç”¨å¼€å§‹åŸºäºå®¹å™¨éƒ¨ç½²ï¼Œç‰¹åˆ«æ˜¯ç®¡æ§å¹³é¢ä½¿ç”¨äº†k8sï¼Œé‚£ä¹ˆæ‰‹åŠ¨é…ç½®Prometheusã€é‡å¯å°±æˆä¸ºäº†å™©æ¢¦ä¸€æ ·çš„å­˜åœ¨ï¼è¿ç»´ä¼šç–²äºå¥”å‘½ï¼Œå¼€å‘ä¼šåæ§½è¿ç»´ã€‚
æ‰€ä»¥ç›‘æ§ç›®æ ‡çš„é…ç½®ï¼Œå–å†³äºä½¿ç”¨çš„åº•å±‚æŠ€æœ¯ï¼
é¢˜å¤–è¯ï¼šè¦æƒ³Devopsåœ¨ä¼ä¸šè½åœ°ï¼Œå¾—æœ‰ä¸€æ•´å¥—é…å¥—çš„å·¥å…·ï¼Œæ•´ä½“æ‰“é€šã€‚
é‚£ä¹ˆPrometheusåœ¨æŠ“å–ç›®æ ‡æ–¹é¢æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿæˆ‘ä»¬å…ˆé‡æ¸©ä¸€ä¸‹ç›¸å…³ç»„ä»¶çš„å¯åŠ¨ï¼š
{ // Scrape discovery manager. g.Add( func() error { err := discoveryManagerScrape.Run() level.Info(logger).Log("msg", "Scrape discovery manager stopped") return err }, func(err error) { level.Info(logger).Log("msg", "Stopping scrape discovery manager...") cancelScrape() }, ) } { // Notify discovery manager. ... } { // Scrape manager. g.Add( func() error { // When the scrape manager receives a new targets list // it needs to read a valid config for each job. // It depends on the config being in sync with the discovery manager so // we wait until the config is fully loaded. &lt;-reloadReady.C err := scrapeManager.Run(discoveryManagerScrape.SyncCh()) level.Info(logger).Log("msg", "Scrape manager stopped") return err }, func(err error) { // Scrape manager needs to be stopped before closing the local TSDB // so that it doesn't try to write samples to a closed storage. level.Info(logger).Log("msg", "Stopping scrape manager...") scrapeManager.Stop() }, ) } å¯åŠ¨çš„æ ¸å¿ƒè¯­å¥ï¼š
...</p></div><footer class=entry-footer><span title='2021-03-22 21:31:03 +0800 +0800'>2021-03-22</span>&nbsp;Â·&nbsp;Jerry Wang</footer><a class=entry-link aria-label="post link to Prometheuså†…éƒ¨å®ç°(å››)" href=https://solaim.github.io/posts/prometheus%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0%E5%9B%9B/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Prometheuså†…éƒ¨å®ç°(ä¸‰)</h2></header><div class=entry-content><p>éçº¿æ€§ => çº¿æ€§ï¼Œæ··ä¹± => ç§©åº
ä¸Šä¸€ç¯‡åšæ–‡ä¸»è¦å†™äº†Prometheus serverçš„å¯åŠ¨è¿‡ç¨‹ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ·±å…¥å„ä¸ªç»„ä»¶ï¼Œäº†è§£å…¶å…·ä½“å®ç°ï¼Œè¿™ç¯‡æ–‡ä»¶ä¸»è¦ä»‹ç»Initial configuration loadingéƒ¨åˆ†ã€‚
Prometheus serverçš„mainå‡½æ•°æœ‰ä¸¤ä¸ªå¾ˆç²¾å½©çš„å®ç°ï¼Œä¸€ä¸ªæ˜¯reloaderçš„æ³¨å†Œï¼Œä¸€ä¸ªæ˜¯ç»„ä»¶å¯åŠ¨ã€‚ä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œæ‰€æœ‰çš„ç»„ä»¶éƒ½æ˜¯åŒæ—¶å¯åŠ¨çš„å—ï¼Ÿè¿˜æ˜¯æœ‰ä»€ä¹ˆé¡ºåºï¼Ÿ
æˆ‘ä»¬åˆ—ä¸€ä¸ªç»„ä»¶æ¸…å•ï¼š
- Termination handler. - Scrape discovery manager. - Notify discovery manager. - Scrape manager. - Reload handler. - Rule manager. - TSDB. - Web handler. - Notifier. å†æ¥çœ‹ä¸€ä¸‹ç»„ä»¶å¯åŠ¨ä½¿ç”¨çš„åº•å±‚æŠ€æœ¯:
run.Group is a universal mechanism to manage goroutine lifecycles.
Create a zero-value run.Group, and then add actors to it. Actors are defined as a pair of functions: an execute function, which should run synchronously; and an interrupt function, which, when invoked, should cause the execute function to return. Finally, invoke Run, which concurrently runs all of the actors, waits until the first actor exits, invokes the interrupt functions, and finally returns control to the caller only once all actors have returned. This general-purpose API allows callers to model pretty much any runnable task, and achieve well-defined lifecycle semantics for the group.
...</p></div><footer class=entry-footer><span title='2021-03-20 21:29:33 +0800 +0800'>2021-03-20</span>&nbsp;Â·&nbsp;Jerry Wang</footer><a class=entry-link aria-label="post link to Prometheuså†…éƒ¨å®ç°(ä¸‰)" href=https://solaim.github.io/posts/prometheus%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0%E4%B8%89/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Prometheuså†…éƒ¨å®ç°(äºŒ)</h2></header><div class=entry-content><p>è§‚å¯Ÿäº‹ç‰©ï¼Œéœ€è¦æçº²æŒˆé¢†ï¼è½¯ä»¶çš„å¯åŠ¨æ˜¯è§‚å¯Ÿè½¯ä»¶æœ€å¥½çš„å…¥å£ï¼
Prometheus serverå®ç°å…¥å£æ–‡ä»¶åœ¨cmd/prometheus/main.goã€‚
Prometheusçš„é…ç½®ç”±ä¸¤ä¸ªéƒ¨åˆ†æ„æˆï¼š
é…ç½®æ–‡ä»¶ï¼šprometheus.yml å¯åŠ¨flagï¼šå¯åŠ¨æ—¶æŒ‡å®š å…¥å£å‡½æ•°å¦‚ä¸‹ï¼š
func main() { ... } åˆå§‹åŒ–ä¸€ä¸ªflagConfigï¼Œè¿™ä¸ªé…ç½®è´¯ç©¿äº†æ•´ä¸ªç¨‹åº
cfg := flagConfig{ notifier: notifier.Options{ Registerer: prometheus.DefaultRegisterer, }, web: web.Options{ Registerer: prometheus.DefaultRegisterer, Gatherer: prometheus.DefaultGatherer, }, promlogConfig: promlog.Config{}, } ä½¿ç”¨kingpinæ³¨å†Œflag
a := kingpin.New(filepath.Base(os.Args[0]), "The Prometheus monitoring server").UsageWriter(os.Stdout) a.Version(version.Print("prometheus")) a.HelpFlag.Short('h') a.Flag("config.file", "Prometheus configuration file path."). Default("prometheus.yml").StringVar(&amp;cfg.configFile) a.Flag("web.listen-address", "Address to listen on for UI, API, and telemetry."). Default("0.0.0.0:9090").StringVar(&amp;cfg.web.ListenAddress) ... _, err := a.Parse(os.Args[1:]) if err != nil { fmt.Fprintln(os.Stderr, errors.Wrapf(err, "Error parsing commandline arguments")) a.Usage(os.Args[1:]) os.Exit(2) } åŠ è½½é…ç½®æ–‡ä»¶ï¼Œæ£€æŸ¥é…ç½®åˆæ³•æ€§
if _, err := config.LoadFile(cfg.configFile); err != nil { level.Error(logger).Log("msg", fmt.Sprintf("Error loading config (--config.file=%s)", cfg.configFile), "err", err) os.Exit(2) } åˆå§‹åŒ–å„ç§ç»„ä»¶
var ( localStorage = &amp;readyStorage{} scraper = &amp;readyScrapeManager{} remoteStorage = remote.NewStorage(log.With(logger, "component", "remote"), prometheus.DefaultRegisterer, localStorage.StartTime, cfg.localStoragePath, time.Duration(cfg.RemoteFlushDeadline), scraper) fanoutStorage = storage.NewFanout(logger, localStorage, remoteStorage) ) var ( ctxWeb, cancelWeb = context.WithCancel(context.Background()) ctxRule = context.Background() notifierManager = notifier.NewManager(&amp;cfg.notifier, log.With(logger, "component", "notifier")) ctxScrape, cancelScrape = context.WithCancel(context.Background()) discoveryManagerScrape = discovery.NewManager(ctxScrape, log.With(logger, "component", "discovery manager scrape"), discovery.Name("scrape")) ctxNotify, cancelNotify = context.WithCancel(context.Background()) discoveryManagerNotify = discovery.NewManager(ctxNotify, log.With(logger, "component", "discovery manager notify"), discovery.Name("notify")) scrapeManager = scrape.NewManager(log.With(logger, "component", "scrape manager"), fanoutStorage) opts = promql.EngineOpts{ Logger: log.With(logger, "component", "query engine"), Reg: prometheus.DefaultRegisterer, MaxSamples: cfg.queryMaxSamples, Timeout: time.Duration(cfg.queryTimeout), ActiveQueryTracker: promql.NewActiveQueryTracker(cfg.localStoragePath, cfg.queryConcurrency, log.With(logger, "component", "activeQueryTracker")), LookbackDelta: time.Duration(cfg.lookbackDelta), NoStepSubqueryIntervalFn: noStepSubqueryInterval.Get, EnableAtModifier: cfg.enablePromQLAtModifier, EnableNegativeOffset: cfg.enablePromQLNegativeOffset, } queryEngine = promql.NewEngine(opts) ruleManager = rules.NewManager(&amp;rules.ManagerOptions{ Appendable: fanoutStorage, Queryable: localStorage, QueryFunc: rules.EngineQueryFunc(queryEngine, fanoutStorage), NotifyFunc: sendAlerts(notifierManager, cfg.web.ExternalURL.String()), Context: ctxRule, ExternalURL: cfg.web.ExternalURL, Registerer: prometheus.DefaultRegisterer, Logger: log.With(logger, "component", "rule manager"), OutageTolerance: time.Duration(cfg.outageTolerance), ForGracePeriod: time.Duration(cfg.forGracePeriod), ResendDelay: time.Duration(cfg.resendDelay), }) ) scraper.Set(scrapeManager) å°†é…ç½®æ›´æ–°åˆ°flagConfig
...</p></div><footer class=entry-footer><span title='2021-03-15 21:28:09 +0800 +0800'>2021-03-15</span>&nbsp;Â·&nbsp;Jerry Wang</footer><a class=entry-link aria-label="post link to Prometheuså†…éƒ¨å®ç°(äºŒ)" href=https://solaim.github.io/posts/prometheus%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0%E4%BA%8C/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Prometheuså†…éƒ¨å®ç°(ä¸€)</h2></header><div class=entry-content><p>Prometheusåœ¨ç›‘æ§ç•Œä¸ºä»€ä¹ˆè¿™ä¹ˆğŸ”¥ï¼Ÿ
Prometheuså…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ
äººå¦‚å…¶åï¼Œäº§å“äº¦æ˜¯ï¼Prometheuså°±æ˜¯ç«ç§ï¼Œç…§è€€åœ¨å½“å‰çš„ç›‘æ§ä¸–ç•Œï¼
Prometheusè¿™æŠŠç«ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œç«åœ¨ä¸‰ä¸ªæ–¹é¢ï¼š
ç³»å‡ºåé—¨ï¼šCNCFçš„ç¬¬äºŒä¸ªé¡¹ç›®ï¼ŒCNCFçš„è€å¤§å«K8Sï¼Œè€å¤§å¯¹è€äºŒå¾ˆç…§é¡¾ï¼Œç›‘æ§é¦–é€‰ã€‚ é—¨åº­è‹¥å¸‚ï¼šå¼€æºï¼Œå¤§å‚ç«ç›¸äº‰ç”¨ã€‚ ç®€å•æ˜“ç”¨ï¼šæ¶æ„ç®€å•ï¼Œé…ç½®ç®€å•ï¼Œä¸Šä¸‹æ¸¸æ‰“é€šã€‚ å¤§å®¶éƒ½åœ¨ç”¨ï¼Œè€Œä¸”ç”¨èµ·æ¥å¾ˆæ–¹ä¾¿çš„ç¡®æ˜¯æˆ‘ä»¬é€‰æ‹©äº§å“çš„æ–¹æ³•ï¼Œä½†æ˜¯ä½œä¸ºå¼€å‘äººå‘˜ï¼Œè¿˜æ˜¯éœ€è¦äº†è§£ä¸€ä¸‹å…¶å†…éƒ¨çš„å®ç°ã€‚è¿™ä¸ªç³»åˆ—ï¼Œä¸»è¦æ ¹æ®Prometheusçš„ä»£ç å’Œæ–‡æ¡£ï¼Œæ¢³ç†Prometheusçš„å†…éƒ¨å®ç°ã€‚
æ€»ä½“æ¶æ„ Prometheusä»é…ç½®çš„jobsä¸­æŠ“å–metricsï¼Œå­˜å‚¨åœ¨æœ¬åœ°å­˜å‚¨æˆ–è€…å¤–éƒ¨å­˜å‚¨ä¸­ï¼Œåœ¨metricsä¸Šè¿è¡Œè§„åˆ™èšåˆå¤šç»´åº¦çš„æ•°æ®æˆ–è€…ç”Ÿæˆå‘Šè­¦ã€‚Grafanaæˆ–è€…è‡ªå¸¦çš„web UIèƒ½å¤Ÿæ–¹ä¾¿çš„å±•ç¤ºæ•°æ®ã€‚
Prometheusçš„ç»„ä»¶åŒ…æ‹¬ï¼š
serverï¼šè´Ÿè´£æŠ“å–metricsï¼Œå­˜å‚¨metricsï¼Œåˆ†æã€èšåˆmetrics client libraryï¼šå¤šç§è¯­è¨€çš„å®¢æˆ·ç«¯åº“ï¼Œæ–¹ä¾¿å®ç° push gatewayï¼šçŸ­æœŸå­˜æ´»æœåŠ¡metricsæ¨é€ç½‘å…³ exportersï¼šæ¯”å¦‚ç›‘æ§èŠ‚ç‚¹çš„node_exporterï¼Œç›‘æ§MySQLçš„mysqld_expoterç­‰ç­‰ alertmanagerï¼šalertmanagerè´Ÿè´£å‘Šè­¦çš„å‘é€ ä»æ€»ä½“æ¶æ„ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£å„ç§ç»„ä»¶ï¼Œä»¥åŠæ•°æ®çš„æµå‘ï¼Œç°åœ¨æˆ‘ä»¬å¼€å§‹ç ”ç©¶Prometheus serverçš„å†…éƒ¨å®ç°ã€‚
Serverå®ç°æ¶æ„ serverå¯åŠ¨çš„æ—¶å€™ï¼Œæ ¹æ®é…ç½®æ–‡ä»¶prometheus.ymlå’Œflagå†³å®šå„ç§é…ç½®ï¼Œé…ç½®æ–‡ä»¶åŒ…æ‹¬å…¨å±€é…ç½®ã€æŠ“å–ç›®æ ‡é…ç½®å’Œè§„åˆ™é…ç½®ç­‰ç­‰ã€‚scrape_configsé…ç½®äº†æŠ“å–çš„ç›®æ ‡ï¼ŒPrometheusæ”¯æŒåŠ¨æ€è·å–ç›®æ ‡ï¼ŒService discoveryè¯»å–é™æ€é…ç½®çš„ç›®æ ‡æˆ–è€…å‘¨æœŸæ›´æ–°åŠ¨æ€ç›®æ ‡ï¼Œæ·»åŠ åˆ°scrape managerï¼Œscrape managerè´Ÿè´£æŠ“å–ç›®æ ‡ï¼ŒæŠ“å–å®é™…æ˜¯ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œå³å„ç§exporterså®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªç®€å•çš„HTTPæœåŠ¡ï¼Œè´Ÿè´£æš´éœ²å„ç§åº”ç”¨çš„æŒ‡æ ‡ã€‚scrape manageræŠ“å–æŒ‡æ ‡åï¼Œå°†æ•°æ®äº¤ç»™fanout storageï¼Œfanout storageè´Ÿè´£æ•°æ®å­˜å‚¨ï¼Œæ”¯æŒæœ¬åœ°å­˜å‚¨å’Œå¤–éƒ¨å­˜å‚¨ã€‚rule manageræ ¹æ®è§„åˆ™ï¼ŒèšåˆæŒ‡æ ‡å­˜å‚¨åˆ°fanout storageï¼Œæˆ–è€…ç”Ÿæˆå‘Šè­¦å‘é€ç»™alert managerã€‚Prometheusä¹Ÿå®ç°äº†å„ç§webæ¥å£ï¼Œä½¿ç”¨promQLè¿›è¡Œæ•°æ®çš„æŸ¥è¯¢ã€‚
serverçš„ç»„ä»¶åŒ…æ‹¬ï¼š
Termination handler. Scrape discovery manager. Notify discovery manager. Scrape manager. Reload handler. Rule manager. TSDB. Web handler. Notifier. äº†è§£äº†serverçš„åŸºæœ¬æ¶æ„ï¼Œä¸‹é¢å¼€å§‹ç ”ç©¶serverçš„é…ç½®ã€‚
Prometheus.yml global: scrape_interval: 15s evaluation_interval: 15s rule_files: # - "first.rules" # - "second.rules" scrape_configs: - job_name: prometheus static_configs: - targets: ['localhost:9090'] è¿™æ˜¯å®˜ç½‘æä¾›çš„ä¸€ä¸ªç®€å•çš„é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«äº†ä¸‰ä¸ªéƒ¨åˆ†ï¼šå…¨å±€é…ç½®ã€è§„åˆ™é…ç½®å’ŒæŠ“å–é…ç½®ã€‚globalåŒ…æ‹¬å…¨å±€çš„é…ç½®ï¼Œrule_filesé…ç½®è§„åˆ™æ–‡ä»¶ï¼Œè¿™é‡Œæ²¡æœ‰é…ç½®ï¼Œscrape_configsé…ç½®æŠ“å–ç›®æ ‡ã€‚æŠ“å–ç›®æ ‡æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼ŒåŒ…æ‹¬å¤šä¸ªjobï¼Œæ¯ä¸ªjobæœ‰ä¸€ä¸ªjob_nameï¼Œç›®æ ‡é…ç½®ä»¥åŠå…¶ä»–é…ç½®ï¼Œç›®æ ‡é…ç½®å› ä¸ºæ”¯æŒå¤šç§ç›®æ ‡æºï¼Œæ‰€ä»¥è¿™å—åœ¨ä»£ç ä¸­çš„å®ç°æ¯”è¾ƒå¤æ‚ã€‚
...</p></div><footer class=entry-footer><span title='2021-03-14 21:32:08 +0800 +0800'>2021-03-14</span>&nbsp;Â·&nbsp;Jerry Wang</footer><a class=entry-link aria-label="post link to Prometheuså†…éƒ¨å®ç°(ä¸€)" href=https://solaim.github.io/posts/prometheus%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0%E4%B8%80/></a></article></main><footer class=footer><span>&copy; 2025 <a href=https://solaim.github.io/>Jerry Wang</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>